import{$ as O,_ as $e,C as qe,d as Re,r as I,O as Te,T as Le,u as Pe,a as Ae,v as ze,w as Be,e as r,R as oe,c as V,o as d,H as S,h as a,S as ne,B as e,i as s,l as He,F as D,D as $,j as b,m as f,P as W,f as t,A as p,k as B,s as Oe,t as je}from"./index-CqU5sET7.js";import{l as Ee}from"./destinations-CNa6kP2I.js";import{l as Ke}from"./userManage-B6SVjGn0.js";import{l as ie}from"./page-DmiFfIKn.js";function Ge(g){return O({url:"/manage/travelNotesManage/list",method:"get",params:g})}function Je(g){return O({url:"/manage/travelNotesManage/"+g,method:"get"})}function We(g){return O({url:"/manage/travelNotesManage",method:"post",data:g})}function H(g){return O({url:"/manage/travelNotesManage",method:"put",data:g})}const c=g=>(Oe("data-v-3bba79da"),g=g(),je(),g),Xe={class:"app-container"},Ye={class:"travel-notes-grid"},Ze={class:"note-header"},Qe={class:"note-id"},et={class:"note-actions"},tt={class:"note-content"},lt={class:"cover-image"},at={key:1,class:"no-cover"},st={class:"note-info"},ot={class:"note-title"},nt={class:"user-info"},it=c(()=>t("span",{class:"label"},"作者:",-1)),ut={class:"value"},dt={class:"destination-info"},rt=c(()=>t("span",{class:"label"},"地点:",-1)),ct={class:"value"},_t={class:"note-stats"},pt={class:"stat-item"},mt=c(()=>t("i",{class:"el-icon-view"},null,-1)),vt={class:"stat-item"},ft=c(()=>t("i",{class:"el-icon-thumb"},null,-1)),gt={class:"note-footer"},ht={class:"note-status"},It=c(()=>t("span",{class:"label"},"状态:",-1)),bt={class:"note-featured"},Vt=c(()=>t("span",{class:"label"},"推荐:",-1)),yt={class:"dialog-content"},wt={class:"section"},kt=c(()=>t("div",{class:"section-title"},[t("i",{class:"el-icon-edit"}),t("span",null,"游记标题")],-1)),Ct={class:"section"},Nt=c(()=>t("div",{class:"section-title"},[t("i",{class:"el-icon-picture"}),t("span",null,"游记图片")],-1)),Ft=c(()=>t("div",{class:"upload-tip"},"最多可上传10张图片，第一张将作为封面图",-1)),Mt={class:"section"},St=c(()=>t("div",{class:"section-title"},[t("i",{class:"el-icon-document"}),t("span",null,"游记内容")],-1)),Ut={class:"section"},xt=c(()=>t("div",{class:"section-title"},[t("i",{class:"el-icon-info"}),t("span",null,"基本信息")],-1)),Dt=c(()=>t("div",{class:"form-tip"},"系统默认用户ID为1（官方账号）",-1)),$t=c(()=>t("div",{class:"form-tip"},"系统默认状态为审核通过",-1)),qt={class:"dialog-footer"},Rt={class:"article-content"},Tt={class:"article-title"},Lt={class:"article-meta"},Pt={class:"meta-item"},At=c(()=>t("i",{class:"el-icon-user"},null,-1)),zt={class:"meta-item"},Bt=c(()=>t("i",{class:"el-icon-location"},null,-1)),Ht={class:"meta-item"},Ot=c(()=>t("i",{class:"el-icon-time"},null,-1)),jt={class:"meta-item"},Et=c(()=>t("i",{class:"el-icon-view"},null,-1)),Kt={class:"meta-item"},Gt=c(()=>t("i",{class:"el-icon-thumb"},null,-1)),Jt={key:0,class:"article-images"},Wt={class:"carousel-image-container"},Xt=["innerHTML"],Yt={class:"article-status"},Zt=c(()=>t("span",{class:"label"},"状态:",-1)),Qt=c(()=>t("span",{class:"label ml-20"},"推荐:",-1)),el={class:"dialog-footer"},tl=qe({name:"TravelNotesManage"}),ll=Object.assign(tl,{setup(g){const{proxy:m}=Re(),{travel_notes_status:j,yes_no:q}=m.useDict("travel_notes_status","yes_no"),X=I([]),F=I(!1),M=I(!1),E=I(!0),R=I(!0);I([]),I(!0),I(!0);const K=I(0),Y=I(""),ue=Te({form:{},viewForm:{},queryParams:{pageNum:1,pageSize:10,userId:null,title:null,destinationId:null,status:null,isFeatured:null},rules:{title:[{required:!0,message:"游记标题不能为空",trigger:"blur"}],coverImage:[{required:!0,message:"图片不能为空",trigger:"blur"}],content:[{required:!0,message:"游记内容不能为空",trigger:"blur"}]}}),{queryParams:_,form:i,viewForm:u,rules:de}=Le(ue),T=Pe(),re=Ae();ze(()=>{T.query.userId&&(_.value.userId=T.query.userId,U())}),Be(()=>T.query,n=>{n&&n.userId?(_.value.userId=n.userId,U()):n&&n.userId===void 0&&(_.value.userId=null,U())},{immediate:!0,deep:!0});function y(){E.value=!0,Ge(_.value).then(n=>{X.value=n.rows,K.value=n.total,E.value=!1})}function ce(){F.value=!1,Z()}function Z(){i.value={noteId:null,userId:1,title:null,content:null,coverImage:null,destinationId:null,status:2,viewCount:0,likeCount:0,isFeatured:0,createdAt:null,updatedAt:null},m.resetForm("travelNotesManageRef")}function U(){_.value.pageNum=1,y()}function _e(){m.resetForm("queryRef"),_.value={pageNum:1,pageSize:10,userId:null,title:null,destinationId:null,status:null,isFeatured:null},T.query.userId&&re.replace({query:{}}),U()}function pe(){Z(),F.value=!0,Y.value="添加官方游记"}function me(n){Je(n.noteId).then(o=>{u.value=o.data,M.value=!0})}function ve(){M.value=!1}function fe(n){const o=n.isFeatured===1?"取消推荐":"推荐";m.$modal.confirm(`确认${o}该游记？`).then(()=>{const w={noteId:n.noteId,isFeatured:n.isFeatured===1?0:1};return H(w)}).then(()=>{m.$modal.msgSuccess(`${o}成功`),y()}).catch(()=>{})}function ge(){m.$modal.confirm("确认审核通过该游记？").then(()=>{const n={noteId:u.value.noteId,status:2};return H(n)}).then(()=>{m.$modal.msgSuccess("审核通过成功"),M.value=!1,y()}).catch(()=>{})}function Q(){m.$modal.confirm("确认下架该游记？").then(()=>{const n={noteId:u.value.noteId,status:3};return H(n)}).then(()=>{m.$modal.msgSuccess("下架成功"),M.value=!1,y()}).catch(()=>{})}function he(){m.$refs.travelNotesManageRef.validate(n=>{n&&(i.value.userId=1,i.value.status=2,i.value.noteId!=null?H(i.value).then(o=>{m.$modal.msgSuccess("修改成功"),F.value=!1,y()}):We(i.value).then(o=>{m.$modal.msgSuccess("新增成功"),F.value=!1,y()}))})}function Ie(){m.download("manage/travelNotesManage/export",{..._.value},`travelNotesManage_${new Date().getTime()}.xlsx`)}function ee(n){if(!n)return null;if(typeof n=="string"){if(n.includes(",")){const o=n.split(",");return o.length>0?o[0].trim():null}return n.trim()}return null}function L(n){return n?typeof n=="string"?n.split(",").filter(o=>o.trim()!==""):[]:[]}const G=I([]);function be(){Ee({loadAllParams:ie}).then(n=>{G.value=n.data})}const J=I([]);function Ve(){Ke({loadAllParams:ie}).then(n=>{J.value=n.rows})}return y(),be(),Ve(),(n,o)=>{const w=r("el-input"),v=r("el-form-item"),te=r("el-option"),le=r("el-select"),h=r("el-button"),ae=r("el-form"),k=r("el-col"),ye=r("right-toolbar"),P=r("el-row"),we=r("image-preview"),A=r("dict-tag"),ke=r("pagination"),Ce=r("image-upload"),Ne=r("editor"),Fe=r("el-radio"),Me=r("el-radio-group"),se=r("el-dialog"),Se=r("el-image"),Ue=r("el-carousel-item"),xe=r("el-carousel"),z=oe("hasPermi"),De=oe("loading");return d(),V("div",Xe,[S(a(ae,{model:e(_),ref:"queryRef",inline:!0,"label-width":"68px"},{default:s(()=>[a(v,{label:"游记标题",prop:"title"},{default:s(()=>[a(w,{modelValue:e(_).title,"onUpdate:modelValue":o[0]||(o[0]=l=>e(_).title=l),placeholder:"请输入游记标题",clearable:"",onKeyup:He(U,["enter"])},null,8,["modelValue"])]),_:1}),a(v,{label:"游记状态",prop:"status"},{default:s(()=>[a(le,{modelValue:e(_).status,"onUpdate:modelValue":o[1]||(o[1]=l=>e(_).status=l),placeholder:"请选择状态",clearable:""},{default:s(()=>[(d(!0),V(D,null,$(e(j),l=>(d(),b(te,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"是否推荐",prop:"isFeatured"},{default:s(()=>[a(le,{modelValue:e(_).isFeatured,"onUpdate:modelValue":o[2]||(o[2]=l=>e(_).isFeatured=l),placeholder:"请选择是否推荐",clearable:""},{default:s(()=>[(d(!0),V(D,null,$(e(q),l=>(d(),b(te,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,null,{default:s(()=>[a(h,{type:"primary",icon:"Search",onClick:U},{default:s(()=>[f("搜索")]),_:1}),a(h,{icon:"Refresh",onClick:_e},{default:s(()=>[f("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[ne,e(R)]]),a(P,{gutter:10,class:"mb8"},{default:s(()=>[a(k,{span:1.5},{default:s(()=>[S((d(),b(h,{type:"primary",plain:"",icon:"Plus",onClick:pe},{default:s(()=>[f("添加官方游记")]),_:1})),[[z,["manage:travelNotesManage:add"]]])]),_:1}),a(k,{span:1.5},{default:s(()=>[S((d(),b(h,{type:"warning",plain:"",icon:"Download",onClick:Ie},{default:s(()=>[f("导出")]),_:1})),[[z,["manage:travelNotesManage:export"]]])]),_:1}),a(ye,{showSearch:e(R),"onUpdate:showSearch":o[3]||(o[3]=l=>W(R)?R.value=l:null),onQueryTable:y},null,8,["showSearch"])]),_:1}),S((d(),V("div",Ye,[(d(!0),V(D,null,$(e(X),l=>{var x,C;return d(),V("div",{key:l.noteId,class:"travel-note-card"},[t("div",Ze,[t("div",Qe,"游记ID: "+p(l.noteId),1),t("div",et,[S((d(),b(h,{link:"",type:"primary",icon:"View",onClick:N=>me(l)},{default:s(()=>[f("查看")]),_:2},1032,["onClick"])),[[z,["manage:travelNotesManage:query"]]]),S((d(),b(h,{link:"",type:l.isFeatured===1?"danger":"success",icon:(l.isFeatured===1,"Star"),onClick:N=>fe(l)},{default:s(()=>[f(p(l.isFeatured===1?"取消推荐":"推荐"),1)]),_:2},1032,["type","icon","onClick"])),[[z,["manage:travelNotesManage:edit"]]])])]),t("div",tt,[t("div",lt,[ee(l.coverImage)?(d(),b(we,{key:0,src:ee(l.coverImage),width:120,height:120},null,8,["src"])):(d(),V("div",at,"暂无封面"))]),t("div",st,[t("div",ot,p(l.title),1),t("div",nt,[it,t("span",ut,p(((x=e(J).find(N=>N.userId===l.userId))==null?void 0:x.nickName)||l.userId),1)]),t("div",dt,[rt,t("span",ct,p(((C=e(G).find(N=>N.destinationId===l.destinationId))==null?void 0:C.name)||l.destinationId),1)]),t("div",_t,[t("div",pt,[mt,t("span",null,p(l.viewCount||0)+" 浏览",1)]),t("div",vt,[ft,t("span",null,p(l.likeCount||0)+" 点赞",1)])])])]),t("div",gt,[t("div",ht,[It,a(A,{options:e(j),value:l.status},null,8,["options","value"])]),t("div",bt,[Vt,a(A,{options:e(q),value:l.isFeatured},null,8,["options","value"])])])])}),128))])),[[De,e(E)]]),S(a(ke,{total:e(K),page:e(_).pageNum,"onUpdate:page":o[4]||(o[4]=l=>e(_).pageNum=l),limit:e(_).pageSize,"onUpdate:limit":o[5]||(o[5]=l=>e(_).pageSize=l),onPagination:y},null,8,["total","page","limit"]),[[ne,e(K)>0]]),a(se,{title:e(Y),modelValue:e(F),"onUpdate:modelValue":o[15]||(o[15]=l=>W(F)?F.value=l:null),width:"800px","append-to-body":"",class:"travel-note-dialog"},{footer:s(()=>[t("div",qt,[a(h,{onClick:ce},{default:s(()=>[f("取 消")]),_:1}),a(h,{type:"primary",onClick:he},{default:s(()=>[f("发 布")]),_:1})])]),default:s(()=>[a(ae,{ref:"travelNotesManageRef",model:e(i),rules:e(de),"label-width":"80px"},{default:s(()=>[t("div",yt,[t("div",wt,[kt,a(v,{prop:"title"},{default:s(()=>[a(w,{modelValue:e(i).title,"onUpdate:modelValue":o[6]||(o[6]=l=>e(i).title=l),placeholder:"请输入游记标题",class:"title-input",size:"large"},null,8,["modelValue"])]),_:1})]),t("div",Ct,[Nt,a(v,{prop:"coverImage"},{default:s(()=>[a(Ce,{modelValue:e(i).coverImage,"onUpdate:modelValue":o[7]||(o[7]=l=>e(i).coverImage=l),limit:10,class:"image-uploader"},null,8,["modelValue"]),Ft]),_:1})]),t("div",Mt,[St,a(v,{prop:"content"},{default:s(()=>[a(Ne,{modelValue:e(i).content,"onUpdate:modelValue":o[8]||(o[8]=l=>e(i).content=l),"min-height":300,class:"content-editor"},null,8,["modelValue"])]),_:1})]),t("div",Ut,[xt,a(P,{gutter:20},{default:s(()=>[a(k,{span:12},{default:s(()=>[a(v,{label:"用户ID",prop:"userId"},{default:s(()=>[a(w,{modelValue:e(i).userId,"onUpdate:modelValue":o[9]||(o[9]=l=>e(i).userId=l),disabled:"",placeholder:"系统默认为1"},null,8,["modelValue"]),Dt]),_:1})]),_:1}),a(k,{span:12},{default:s(()=>[a(v,{label:"目的地ID",prop:"destinationId"},{default:s(()=>[a(w,{modelValue:e(i).destinationId,"onUpdate:modelValue":o[10]||(o[10]=l=>e(i).destinationId=l),placeholder:"请输入目的地ID"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(P,{gutter:20},{default:s(()=>[a(k,{span:12},{default:s(()=>[a(v,{label:"浏览数",prop:"viewCount"},{default:s(()=>[a(w,{modelValue:e(i).viewCount,"onUpdate:modelValue":o[11]||(o[11]=l=>e(i).viewCount=l),placeholder:"请输入浏览数",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{span:12},{default:s(()=>[a(v,{label:"点赞数",prop:"likeCount"},{default:s(()=>[a(w,{modelValue:e(i).likeCount,"onUpdate:modelValue":o[12]||(o[12]=l=>e(i).likeCount=l),placeholder:"请输入点赞数",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(P,{gutter:20},{default:s(()=>[a(k,{span:12},{default:s(()=>[a(v,{label:"是否推荐",prop:"isFeatured"},{default:s(()=>[a(Me,{modelValue:e(i).isFeatured,"onUpdate:modelValue":o[13]||(o[13]=l=>e(i).isFeatured=l)},{default:s(()=>[(d(!0),V(D,null,$(e(q),l=>(d(),b(Fe,{key:l.value,label:parseInt(l.value)},{default:s(()=>[f(p(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(k,{span:12},{default:s(()=>[a(v,{label:"状态",prop:"status"},{default:s(()=>[a(w,{modelValue:e(i).status,"onUpdate:modelValue":o[14]||(o[14]=l=>e(i).status=l),disabled:"",placeholder:"系统默认为审核通过"},null,8,["modelValue"]),$t]),_:1})]),_:1})]),_:1})])])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),a(se,{title:"游记详情",modelValue:e(M),"onUpdate:modelValue":o[16]||(o[16]=l=>W(M)?M.value=l:null),width:"800px","append-to-body":"",class:"article-view-dialog"},{footer:s(()=>[t("div",el,[a(h,{onClick:ve},{default:s(()=>[f("取 消")]),_:1}),e(u).status===1||e(u).status===3?(d(),b(h,{key:0,type:"success",onClick:ge},{default:s(()=>[f("审核通过")]),_:1})):B("",!0),e(u).status===1||e(u).status===3?(d(),b(h,{key:1,type:"warning",onClick:Q},{default:s(()=>[f("审核不通过")]),_:1})):B("",!0),e(u).status===2?(d(),b(h,{key:2,type:"warning",onClick:Q},{default:s(()=>[f("文章下架")]),_:1})):B("",!0)])]),default:s(()=>{var l,x;return[t("div",Rt,[t("h1",Tt,p(e(u).title),1),t("div",Lt,[t("div",Pt,[At,t("span",null,"作者: "+p(((l=e(J).find(C=>C.userId===e(u).userId))==null?void 0:l.nickName)||e(u).userId),1)]),t("div",zt,[Bt,t("span",null,"地点: "+p(((x=e(G).find(C=>C.destinationId===e(u).destinationId))==null?void 0:x.name)||e(u).destinationId),1)]),t("div",Ht,[Ot,t("span",null,"创建时间: "+p(n.parseTime(e(u).createdAt)),1)]),t("div",jt,[Et,t("span",null,"浏览: "+p(e(u).viewCount||0),1)]),t("div",Kt,[Gt,t("span",null,"点赞: "+p(e(u).likeCount||0),1)])]),L(e(u).coverImage)&&L(e(u).coverImage).length>0?(d(),V("div",Jt,[a(xe,{height:"400px","indicator-position":"outside",arrow:"always"},{default:s(()=>[(d(!0),V(D,null,$(L(e(u).coverImage),(C,N)=>(d(),b(Ue,{key:N},{default:s(()=>[t("div",Wt,[a(Se,{src:C,fit:"cover",class:"carousel-image","preview-src-list":L(e(u).coverImage),"initial-index":N,"preview-teleported":!0},null,8,["src","preview-src-list","initial-index"])])]),_:2},1024))),128))]),_:1})])):B("",!0),t("div",{class:"article-body",innerHTML:e(u).content},null,8,Xt),t("div",Yt,[Zt,a(A,{options:e(j),value:e(u).status},null,8,["options","value"]),Qt,a(A,{options:e(q),value:e(u).isFeatured},null,8,["options","value"])])])]}),_:1},8,["modelValue"])])}}}),il=$e(ll,[["__scopeId","data-v-3bba79da"]]);export{il as default};
