import{_ as Ce,C as De,d as Te,r as g,O as Se,T as Pe,u as Ne,v as qe,w as $e,e as m,R as ne,c as f,o as s,H as w,h as l,f as i,S as de,B as t,i as o,l as Re,F as x,D as k,j as I,m as c,P as M,A as _,k as G,s as Ae,t as Le}from"./index-CqU5sET7.js";import{l as ze,u as Be,a as Fe,g as Ee,d as Oe}from"./products-PxzrFPp4.js";import{l as je}from"./productCategories-_SJyE3Tf.js";import{l as Ke}from"./destinations-CNa6kP2I.js";import{l as Qe}from"./productInventory-Cxg-Eup2.js";import{l as J}from"./page-DmiFfIKn.js";const B=N=>(Ae("data-v-f3f12284"),N=N(),Le(),N),He={class:"app-container"},Me={class:"products-grid"},Ge={class:"card-image"},Je={class:"card-content"},We={class:"card-title"},Xe={class:"card-subtitle"},Ye={class:"card-category"},Ze={class:"card-category"},el={key:0},ll={class:"card-destination"},tl={key:0},al={class:"card-days"},ol={class:"card-travelers"},nl={class:"card-time"},dl={class:"card-actions"},sl=B(()=>i("div",{slot:"header",class:"card-header"},[i("i",{class:"el-icon-info-circle mr-2"}),c("基础信息 ")],-1)),rl=B(()=>i("div",{slot:"header",class:"card-header"},[i("i",{class:"el-icon-calendar mr-2"}),c("行程信息 ")],-1)),ul=B(()=>i("div",{slot:"header",class:"card-header"},[i("i",{class:"el-icon-document mr-2"}),c("详情信息 ")],-1)),il=B(()=>i("div",{slot:"header",class:"card-header"},[i("i",{class:"el-icon-picture mr-2"}),c("图片信息 ")],-1)),pl={class:"dialog-footer"},cl={key:0},ml=De({name:"Products"}),fl=Object.assign(ml,{setup(N){const{proxy:b}=Te(),{product_status:W}=b.useDict("product_status"),F=g([]),V=g(!1),q=g(!1),E=g(!0),$=g(!0),O=g([]),se=g(!0),re=g(!0),j=g(0),K=g(""),ue=Se({form:{},queryParams:{pageNum:1,pageSize:10,productId:null,title:null,categoryId:null,destinationId:null,destinationIds:null,durationDays:null,durationNights:null,status:null,minTravelers:null,maxTravelers:null},rules:{title:[{required:!0,message:"产品标题不能为空",trigger:"blur"}],categoryId:[{required:!0,message:"分类ID不能为空",trigger:"blur"}],destinationId:[{required:!0,message:"目的地ID不能为空",trigger:"blur"}],durationDays:[{required:!0,message:"行程天数不能为空",trigger:"blur"}],durationNights:[{required:!0,message:"行程晚数不能为空",trigger:"blur"}],minTravelers:[{required:!0,message:"最小成团人数不能为空",trigger:"blur"}],maxTravelers:[{required:!0,message:"最大参团人数不能为空",trigger:"blur"}]}}),{queryParams:r,form:n,rules:ie}=Pe(ue),C=Ne();qe(()=>{C.query.destinationId&&(r.value.destinationId=C.query.destinationId,r.value.destinationIds=[C.query.destinationId],D())}),$e(()=>C.query,d=>{d.destinationId&&(r.value.destinationId=d.destinationId,r.value.destinationIds=[C.query.destinationId],D())});function U(){E.value=!0,r.value.destinationId=r.value.destinationIds?r.value.destinationIds.slice(-1)[0]:null,ze(r.value).then(d=>{F.value=d.rows,j.value=d.total,E.value=!1})}function pe(){V.value=!1,Q()}function Q(){n.value={productId:null,title:null,subtitle:null,categoryId:null,destinationId:null,destinationIds:null,coverImage:null,images:null,durationDays:null,durationNights:null,overview:null,itinerary:null,inclusions:null,exclusions:null,notes:null,status:null,minTravelers:null,maxTravelers:null,createdAt:null,updatedAt:null},b.resetForm("productsRef")}function D(){r.value.pageNum=1,U()}function ce(){b.resetForm("queryRef"),D()}function me(d){O.value=d.map(a=>a.productId),se.value=d.length!=1,re.value=!d.length}function fe(){Q(),V.value=!0,K.value="添加产品管理"}function ve(d){Q();const a=d.productId||O.value;Ee(a).then(u=>{n.value=u.data,n.value.destinationIds=u.data.destinationId,V.value=!0,K.value="修改产品管理"})}function ge(){b.$refs.productsRef.validate(d=>{d&&(n.value.destinationIds&&(Array.isArray(n.value.destinationIds)?n.value.destinationId=n.value.destinationIds.slice(-1)[0]:(typeof n.value.destinationIds=="number"||typeof n.value.destinationIds=="string")&&(n.value.destinationId=n.value.destinationIds),n.value.destinationIds=null),n.value.productId!=null?Be(n.value).then(a=>{b.$modal.msgSuccess("修改成功"),V.value=!1,U()}):Fe(n.value).then(a=>{b.$modal.msgSuccess("新增成功"),V.value=!1,U()}))})}function _e(d){const a=d.productId||O.value;b.$modal.confirm('是否确认删除产品管理编号为"'+a+'"的数据项？').then(function(){return Oe(a)}).then(()=>{U(),b.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ye(){b.download("manage/products/export",{...r.value},`products_${new Date().getTime()}.xlsx`)}const R=g([]);function Ie(){je({pageNum:1,pageSize:1e4}).then(d=>{R.value=d.rows})}const X=g([]);function Y(d,a=null){return d.filter(u=>u.parentId===a).map(u=>({...u,children:Y(d,u.destinationId)}))}const H=g([]);function be(){Ke({pageNum:1,pageSize:1e4}).then(d=>{X.value=d.data,H.value=Y(d.data)})}const Z=g([]);function he(d){const a=d.productId;J.productId=a,J.isActive=1,Qe(J).then(u=>{Z.value=u.rows,q.value=!0})}return U(),Ie(),be(),(d,a)=>{const u=m("el-input"),p=m("el-form-item"),A=m("el-option"),L=m("el-select"),ee=m("el-cascader"),h=m("el-button"),le=m("el-form"),y=m("el-col"),Ve=m("right-toolbar"),T=m("el-row"),we=m("image-preview"),xe=m("pagination"),z=m("el-card"),te=m("image-upload"),ae=m("el-dialog"),S=m("el-table-column"),oe=m("el-tag"),ke=m("el-table"),P=ne("hasPermi"),Ue=ne("loading");return s(),f("div",He,[w(l(le,{model:t(r),ref:"queryRef",inline:!0,"label-width":"88px"},{default:o(()=>[l(p,{label:"产品标题",prop:"title"},{default:o(()=>[l(u,{modelValue:t(r).title,"onUpdate:modelValue":a[0]||(a[0]=e=>t(r).title=e),placeholder:"请输入产品标题",clearable:"",onKeyup:Re(D,["enter"])},null,8,["modelValue"])]),_:1}),l(p,{label:"产品分类",prop:"categoryId"},{default:o(()=>[l(L,{modelValue:t(r).categoryId,"onUpdate:modelValue":a[1]||(a[1]=e=>t(r).categoryId=e),placeholder:"请选择产品分类",clearable:""},{default:o(()=>[(s(!0),f(x,null,k(t(R),e=>(s(),I(A,{key:e.categoryId,label:e.name,value:e.categoryId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"目的地",prop:"destinationIds"},{default:o(()=>[l(ee,{modelValue:t(r).destinationIds,"onUpdate:modelValue":a[2]||(a[2]=e=>t(r).destinationIds=e),placeholder:"请选择目的地",clearable:"",options:t(H),"show-all-levels":!1,props:{label:"name",value:"destinationId",children:"children",checkStrictly:!0,checkOnClickNode:!0}},null,8,["modelValue","options"])]),_:1}),l(p,{label:"状态",prop:"status"},{default:o(()=>[l(L,{modelValue:t(r).status,"onUpdate:modelValue":a[3]||(a[3]=e=>t(r).status=e),placeholder:"请选择状态",clearable:""},{default:o(()=>[(s(!0),f(x,null,k(t(W),e=>(s(),I(A,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:o(()=>[l(h,{type:"primary",icon:"Search",onClick:D},{default:o(()=>[c("搜索")]),_:1}),l(h,{icon:"Refresh",onClick:ce},{default:o(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[de,t($)]]),l(T,{gutter:10,class:"mb8"},{default:o(()=>[l(y,{span:1.5},{default:o(()=>[w((s(),I(h,{type:"primary",plain:"",icon:"Plus",onClick:fe},{default:o(()=>[c("新增")]),_:1})),[[P,["manage:products:add"]]])]),_:1}),l(y,{span:1.5},{default:o(()=>[w((s(),I(h,{type:"warning",plain:"",icon:"Download",onClick:ye},{default:o(()=>[c("导出")]),_:1})),[[P,["manage:products:export"]]])]),_:1}),l(Ve,{showSearch:t($),"onUpdate:showSearch":a[4]||(a[4]=e=>M($)?$.value=e:null),onQueryTable:U},null,8,["showSearch"])]),_:1}),i("div",Me,[(s(!0),f(x,null,k(t(F),e=>(s(),f("div",{class:"product-card",key:e.productId},[i("div",Ge,[l(we,{src:e.coverImage,width:140,height:140},null,8,["src"])]),i("div",Je,[i("div",We,_(e.title),1),i("div",Xe,_(e.subtitle),1),i("div",Ye,"产品编号: "+_(e.productId),1),i("div",Ze,[c(" 分类： "),(s(!0),f(x,null,k(t(R),v=>(s(),f("span",{key:v.categoryId},[v.categoryId===e.categoryId?(s(),f("span",el,_(v.name),1)):G("",!0)]))),128))]),i("div",ll,[c(" 目的地： "),(s(!0),f(x,null,k(t(X),v=>(s(),f("span",{key:v.destinationId},[v.destinationId===e.destinationId?(s(),f("span",tl,_(v.name),1)):G("",!0)]))),128))]),i("div",al,_(e.durationDays)+"天"+_(e.durationNights)+"晚 ",1),i("div",ol," 观光团人数："+_(e.minTravelers)+" ~ "+_(e.maxTravelers)+" 人 ",1),i("div",nl," 创建时间："+_(d.parseTime(e.createdAt,"{y}-{m}-{d}")),1),i("div",dl,[w((s(),I(h,{link:"",type:"primary",icon:"Edit",onClick:v=>ve(e)},{default:o(()=>[c("修改")]),_:2},1032,["onClick"])),[[P,["manage:products:edit"]]]),w((s(),I(h,{link:"",type:"primary",icon:"Edit",onClick:v=>he(e)},{default:o(()=>[c("查看在售库存")]),_:2},1032,["onClick"])),[[P,["manage:productInventory:query"]]]),w((s(),I(h,{link:"",type:"danger",icon:"Delete",onClick:v=>_e(e)},{default:o(()=>[c("删除")]),_:2},1032,["onClick"])),[[P,["manage:products:remove"]]])])])]))),128))]),w(l(xe,{total:t(j),page:t(r).pageNum,"onUpdate:page":a[5]||(a[5]=e=>t(r).pageNum=e),limit:t(r).pageSize,"onUpdate:limit":a[6]||(a[6]=e=>t(r).pageSize=e),onPagination:U},null,8,["total","page","limit"]),[[de,t(j)>0]]),l(ae,{title:t(K),modelValue:t(V),"onUpdate:modelValue":a[27]||(a[27]=e=>M(V)?V.value=e:null),width:"900px","append-to-body":"",class:"product-dialog","close-on-click-modal":!1},{default:o(()=>[l(le,{ref:"productsRef",model:t(n),rules:t(ie),"label-width":"110px",class:"product-form"},{default:o(()=>[l(z,{class:"form-card mb-4",shadow:"hover"},{default:o(()=>[sl,l(T,{gutter:24},{default:o(()=>[l(y,{span:8},{default:o(()=>[l(p,{label:"产品标题",prop:"title"},{default:o(()=>[l(u,{modelValue:t(n).title,"onUpdate:modelValue":a[7]||(a[7]=e=>t(n).title=e),placeholder:"请输入产品标题",class:"form-input"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:8},{default:o(()=>[l(p,{label:"副标题",prop:"subtitle"},{default:o(()=>[l(u,{modelValue:t(n).subtitle,"onUpdate:modelValue":a[8]||(a[8]=e=>t(n).subtitle=e),placeholder:"请输入副标题",class:"form-input"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:8},{default:o(()=>[l(p,{label:"分类",prop:"categoryId"},{default:o(()=>[l(L,{modelValue:t(n).categoryId,"onUpdate:modelValue":a[9]||(a[9]=e=>t(n).categoryId=e),placeholder:"请选择分类",clearable:"",class:"form-select"},{default:o(()=>[(s(!0),f(x,null,k(t(R),e=>(s(),I(A,{key:e.categoryId,label:e.name,value:e.categoryId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(y,{span:8},{default:o(()=>[l(p,{label:"目的地",prop:"destinationIds"},{default:o(()=>[l(ee,{modelValue:t(n).destinationIds,"onUpdate:modelValue":a[10]||(a[10]=e=>t(n).destinationIds=e),placeholder:"请选择目的地",clearable:"",options:t(H),"show-all-levels":!1,props:{label:"name",value:"destinationId",children:"children",checkStrictly:!0}},null,8,["modelValue","options"])]),_:1})]),_:1}),l(y,{span:8},{default:o(()=>[l(p,{label:"状态",prop:"status"},{default:o(()=>[l(L,{modelValue:t(n).status,"onUpdate:modelValue":a[11]||(a[11]=e=>t(n).status=e),placeholder:"请选择状态",class:"form-select"},{default:o(()=>[(s(!0),f(x,null,k(t(W),e=>(s(),I(A,{key:e.value,label:e.label,value:parseInt(e.value)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(z,{class:"form-card mb-4",shadow:"hover"},{default:o(()=>[rl,l(T,{gutter:24},{default:o(()=>[l(y,{span:8},{default:o(()=>[l(p,{label:"天数/晚数"},{default:o(()=>[l(u,{modelValue:t(n).durationDays,"onUpdate:modelValue":a[12]||(a[12]=e=>t(n).durationDays=e),type:"number",placeholder:"天数",style:{width:"90px","margin-right":"8px"},class:"form-input",onInput:a[13]||(a[13]=e=>t(n).durationDays=t(n).durationDays.replace(/[^\d]/g,""))},null,8,["modelValue"]),c(" 天 "),l(u,{modelValue:t(n).durationNights,"onUpdate:modelValue":a[14]||(a[14]=e=>t(n).durationNights=e),type:"number",placeholder:"晚数",style:{width:"90px"},class:"form-input",onInput:a[15]||(a[15]=e=>t(n).durationNights=t(n).durationNights.replace(/[^\d]/g,""))},null,8,["modelValue"]),c("   晚 ")]),_:1})]),_:1}),l(y,{span:8},{default:o(()=>[l(p,{label:"团人数"},{default:o(()=>[l(u,{modelValue:t(n).minTravelers,"onUpdate:modelValue":a[16]||(a[16]=e=>t(n).minTravelers=e),type:"number",placeholder:"最小人数",style:{width:"90px","margin-right":"8px"},class:"form-input",onInput:a[17]||(a[17]=e=>t(n).minTravelers=t(n).minTravelers.replace(/[^\d]/g,""))},null,8,["modelValue"]),l(u,{modelValue:t(n).maxTravelers,"onUpdate:modelValue":a[18]||(a[18]=e=>t(n).maxTravelers=e),type:"number",placeholder:"最大人数",style:{width:"90px"},class:"form-input",onInput:a[19]||(a[19]=e=>t(n).maxTravelers=t(n).maxTravelers.replace(/[^\d]/g,""))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(z,{class:"form-card mb-4",shadow:"hover"},{default:o(()=>[ul,l(p,{label:"概述",prop:"overview"},{default:o(()=>[l(u,{modelValue:t(n).overview,"onUpdate:modelValue":a[20]||(a[20]=e=>t(n).overview=e),type:"textarea",placeholder:"请输入产品概述",rows:"3",class:"form-textarea"},null,8,["modelValue"])]),_:1}),l(p,{label:"行程",prop:"itinerary"},{default:o(()=>[l(u,{modelValue:t(n).itinerary,"onUpdate:modelValue":a[21]||(a[21]=e=>t(n).itinerary=e),type:"textarea",placeholder:"请输入行程安排",rows:"4",class:"form-textarea"},null,8,["modelValue"])]),_:1}),l(T,{gutter:24},{default:o(()=>[l(y,{span:12},{default:o(()=>[l(p,{label:"费用包含",prop:"inclusions"},{default:o(()=>[l(u,{modelValue:t(n).inclusions,"onUpdate:modelValue":a[22]||(a[22]=e=>t(n).inclusions=e),type:"textarea",placeholder:"请输入费用包含内容",rows:"4",class:"form-textarea"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:o(()=>[l(p,{label:"费用不含",prop:"exclusions"},{default:o(()=>[l(u,{modelValue:t(n).exclusions,"onUpdate:modelValue":a[23]||(a[23]=e=>t(n).exclusions=e),type:"textarea",placeholder:"请输入费用不包含内容",rows:"4",class:"form-textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(p,{label:"须知",prop:"notes"},{default:o(()=>[l(u,{modelValue:t(n).notes,"onUpdate:modelValue":a[24]||(a[24]=e=>t(n).notes=e),type:"textarea",placeholder:"请输入预订须知",rows:"3",class:"form-textarea"},null,8,["modelValue"])]),_:1})]),_:1}),l(z,{class:"form-card mb-4",shadow:"hover"},{default:o(()=>[il,l(T,{gutter:24},{default:o(()=>[l(y,{span:12},{default:o(()=>[l(p,{label:"封面图",prop:"coverImage"},{default:o(()=>[l(te,{modelValue:t(n).coverImage,"onUpdate:modelValue":a[25]||(a[25]=e=>t(n).coverImage=e),class:"image-uploader"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:o(()=>[l(p,{label:"产品相册",prop:"images"},{default:o(()=>[l(te,{modelValue:t(n).images,"onUpdate:modelValue":a[26]||(a[26]=e=>t(n).images=e),class:"image-uploader",multiple:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),i("div",pl,[l(h,{onClick:pe,class:"cancel-btn"},{default:o(()=>[c("取 消")]),_:1}),l(h,{type:"primary",onClick:ge,class:"confirm-btn"},{default:o(()=>[c("确 定")]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(ae,{title:"在售行程列表",modelValue:t(q),"onUpdate:modelValue":a[28]||(a[28]=e=>M(q)?q.value=e:null),width:"900px","append-to-body":"",class:"product-dialog","close-on-click-modal":!1},{default:o(()=>[w((s(),I(ke,{data:t(Z),onSelectionChange:me},{default:o(()=>[l(S,{label:"序号",align:"center",prop:"inventoryId",type:"index",width:"50"}),l(S,{label:"产品名称",align:"center",prop:"productId"},{default:o(e=>[(s(!0),f(x,null,k(t(F),v=>(s(),f("span",{key:v.productId},[v.productId===e.row.productId?(s(),f("span",cl,_(v.title),1)):G("",!0)]))),128))]),_:1}),l(S,{label:"出发日期",align:"center",prop:"departureDate",width:"180"},{default:o(e=>[i("span",null,_(d.parseTime(e.row.departureDate,"{y}-{m}-{d}")),1)]),_:1}),l(S,{label:"成人价格",align:"center",prop:"adultPrice"},{default:o(e=>[l(oe,null,{default:o(()=>[c("¥"+_(e.row.adultPrice),1)]),_:2},1024)]),_:1}),l(S,{label:"儿童价格",align:"center",prop:"childPrice"},{default:o(e=>[l(oe,null,{default:o(()=>[c("¥"+_(e.row.childPrice),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ue,t(E)]])]),_:1},8,["modelValue"])])}}}),hl=Ce(fl,[["__scopeId","data-v-f3f12284"]]);export{hl as default};
