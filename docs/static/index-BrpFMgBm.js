import{_ as ye,C as we,d as Ie,r as _,O as Ve,T as Se,e as i,R as Q,c as Ce,o as O,H as C,h as e,S as G,B as o,i as a,l as H,m as g,j as q,P as $,f as t,A as r,a1 as Ae,G as Oe,s as ke,t as xe}from"./index-Lq3EucIc.js";import{l as Ne,g as W,u as De,r as qe}from"./manageOrders-DjJZIfBR.js";import{l as Re}from"./page-lV5IMbY_.js";import{l as Pe}from"./products-CBA54OiK.js";const u=k=>(ke("data-v-ae4f19f2"),k=k(),xe(),k),Te={class:"app-container"},Ue=u(()=>t("span",null,"出发日期",-1)),Me={class:"dialog-footer"},$e={class:"order-header"},Be={class:"order-title"},Fe={class:"order-meta"},ze={class:"info-item"},Ee=u(()=>t("span",{class:"info-label"},"用户ID:",-1)),Le={class:"info-value"},je={class:"info-item"},Ke=u(()=>t("span",{class:"info-label"},"产品名称:",-1)),Qe={class:"info-value"},Ge={class:"info-item"},He=u(()=>t("span",{class:"info-label"},"出发日期:",-1)),We={class:"info-value"},Je={class:"info-item"},Xe=u(()=>t("span",{class:"info-label"},"联系人:",-1)),Ye={class:"info-value"},Ze={class:"info-item"},et=u(()=>t("span",{class:"info-label"},"联系电话:",-1)),tt={class:"info-value"},at={class:"info-item"},ot=u(()=>t("span",{class:"info-label"},"联系邮箱:",-1)),lt={class:"info-value"},nt={class:"info-item"},st=u(()=>t("span",{class:"info-label"},"成人数:",-1)),dt={class:"info-value"},rt={class:"info-item"},it=u(()=>t("span",{class:"info-label"},"儿童数:",-1)),ut={class:"info-value"},ct={class:"price-section"},pt={class:"info-item"},_t=u(()=>t("span",{class:"info-label"},"订单总额:",-1)),mt={class:"info-value price"},ft={class:"info-item"},gt=u(()=>t("span",{class:"info-label"},"优惠金额:",-1)),ht={class:"info-value price discount"},vt={class:"info-item"},bt=u(()=>t("span",{class:"info-label"},"支付金额:",-1)),yt={class:"info-value price final"},wt={class:"info-item"},It=u(()=>t("span",{class:"info-label"},"支付方式:",-1)),Vt={class:"info-value"},St={class:"info-item"},Ct=u(()=>t("span",{class:"info-label"},"支付时间:",-1)),At={class:"info-value"},Ot={class:"travelers-section"},kt=u(()=>t("h4",null,"出行人信息",-1)),xt={class:"note-section"},Nt={class:"info-item"},Dt=u(()=>t("span",{class:"info-label"},"退款原因:",-1)),qt={class:"info-value"},Rt={class:"dialog-footer"},Pt=we({name:"ManageOrders"}),Tt=Object.assign(Pt,{setup(k){const{proxy:b}=Ie(),{order_status:J}=b.useDict("order_status"),B=_([]),w=_(!1),R=_(!0),x=_(!0),P=_([]),X=_(!0),Y=_(!0),T=_(0),F=_(""),A=_(!1),z=_(""),d=_({}),Z=Ve({form:{},queryParams:{pageNum:1,pageSize:10,userId:null,productId:null,orderId:null,departureDate:null,orderStatus:null,contactName:null},rules:{userId:[{required:!0,message:"用户ID不能为空",trigger:"blur"}],productId:[{required:!0,message:"产品ID不能为空",trigger:"blur"}],departureDate:[{required:!0,message:"出发日期不能为空",trigger:"blur"}],totalAmount:[{required:!0,message:"订单总额不能为空",trigger:"blur"}],paymentAmount:[{required:!0,message:"支付金额不能为空",trigger:"blur"}],contactName:[{required:!0,message:"联系人姓名不能为空",trigger:"blur"}],contactPhone:[{required:!0,message:"联系人电话不能为空",trigger:"blur"}]}}),{queryParams:p,form:f,rules:ee}=Se(Z);function I(){R.value=!0,p.value.orderStatus="5",Ne(p.value).then(s=>{B.value=s.rows,T.value=s.total,R.value=!1})}function te(s){const n=s.orderId||P.value;W(n).then(h=>{d.value=h.data,A.value=!0,z.value="订单详情"})}function ae(s){switch(s){case"0":return"pending";case"1":return"paid";case"2":return"completed";case"3":return"cancelled";default:return""}}function oe(){w.value=!1,E()}function E(){f.value={orderId:null,paymentAmount:null,payments:{paymentMethod:null}},b.resetForm("manageOrdersRef")}function N(){p.value.pageNum=1,I()}function le(){b.resetForm("queryRef"),N()}function ne(s){P.value=s.map(n=>n.orderId),X.value=s.length!=1,Y.value=!s.length}function se(s){E();const n=s.orderId||P.value;W(n).then(h=>{f.value=h.data,w.value=!0,F.value="订单退款"})}function de(){b.$modal.confirm("是否确认驳回该退款请求？").then(function(){const s={orderId:f.value.orderId,orderStatus:"1"};return De(s)}).then(()=>{b.$modal.msgSuccess("退款请求已驳回"),w.value=!1,I()}).catch(()=>{})}function re(){b.$modal.confirm("是否确认同意该退款请求？").then(function(){const s=f.value.orderId;return qe(s)}).then(()=>{b.$modal.msgSuccess("退款请求已同意"),w.value=!1,I()}).catch(()=>{})}function ie(){b.download("manage/manageOrders/export",{...p.value},`manageOrders_${new Date().getTime()}.xlsx`)}const U=_([]);function ue(){Pe(Re).then(s=>{U.value=s.rows})}return I(),ue(),(s,n)=>{const h=i("el-input"),V=i("el-form-item"),v=i("el-button"),L=i("el-form"),c=i("el-col"),ce=i("right-toolbar"),y=i("el-row"),m=i("el-table-column"),pe=i("el-icon"),_e=i("el-tooltip"),j=i("el-table"),me=i("pagination"),K=i("el-dialog"),fe=i("dict-tag"),D=i("el-divider"),ge=i("el-tag"),he=i("el-card"),M=Q("hasPermi"),ve=Q("loading");return O(),Ce("div",Te,[C(e(L,{model:o(p),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[e(V,{label:"订单号",prop:"orderId"},{default:a(()=>[e(h,{modelValue:o(p).orderId,"onUpdate:modelValue":n[0]||(n[0]=l=>o(p).orderId=l),placeholder:"请输入订单号",clearable:"",onKeyup:H(N,["enter"])},null,8,["modelValue"])]),_:1}),e(V,{label:"联系人",prop:"contactName"},{default:a(()=>[e(h,{modelValue:o(p).contactName,"onUpdate:modelValue":n[1]||(n[1]=l=>o(p).contactName=l),placeholder:"请输入联系人",clearable:"",onKeyup:H(N,["enter"])},null,8,["modelValue"])]),_:1}),e(V,null,{default:a(()=>[e(v,{type:"primary",icon:"Search",onClick:N},{default:a(()=>[g("搜索")]),_:1}),e(v,{icon:"Refresh",onClick:le},{default:a(()=>[g("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[G,o(x)]]),e(y,{gutter:10,class:"mb8"},{default:a(()=>[e(c,{span:1.5},{default:a(()=>[C((O(),q(v,{type:"warning",plain:"",icon:"Download",onClick:ie},{default:a(()=>[g("导出")]),_:1})),[[M,["manage:manageOrders:export"]]])]),_:1}),e(ce,{showSearch:o(x),"onUpdate:showSearch":n[2]||(n[2]=l=>$(x)?x.value=l:null),onQueryTable:I},null,8,["showSearch"])]),_:1}),C((O(),q(j,{data:o(B),onSelectionChange:ne},{default:a(()=>[e(m,{type:"selection",width:"55",align:"center"}),e(m,{label:"订单号",align:"center",prop:"orderId"}),e(m,{label:"用户编号",align:"center",prop:"userId"}),e(m,{label:"产品名称",align:"center",prop:"productId"},{default:a(l=>{var S;return[t("span",null,r(((S=o(U).find(be=>be.productId===l.row.productId))==null?void 0:S.title)||l.row.productId),1)]}),_:1}),e(m,{label:"出发日期",align:"center",prop:"departureDate",width:"180"},{header:a(()=>[Ue,e(_e,{content:"若非旅行服务出发日期代表但不限于使用日期，签发日期等",placement:"top"},{default:a(()=>[e(pe,{style:{"margin-left":"5px",color:"#409EFF",cursor:"pointer"}},{default:a(()=>[e(o(Ae))]),_:1})]),_:1})]),default:a(l=>[t("span",null,r(s.parseTime(l.row.departureDate,"{y}-{m}-{d}")),1)]),_:1}),e(m,{label:"退款原因",align:"center",prop:"note","show-overflow-tooltip":""}),e(m,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(l=>[C((O(),q(v,{link:"",type:"primary",icon:"View",onClick:S=>te(l.row)},{default:a(()=>[g("查看订单详细")]),_:2},1032,["onClick"])),[[M,["manage:manageOrders:query"]]]),C((O(),q(v,{link:"",type:"primary",icon:"Wallet",onClick:S=>se(l.row)},{default:a(()=>[g("处理退款")]),_:2},1032,["onClick"])),[[M,["manage:manageOrders:edit"]]])]),_:1})]),_:1},8,["data"])),[[ve,o(R)]]),C(e(me,{total:o(T),page:o(p).pageNum,"onUpdate:page":n[3]||(n[3]=l=>o(p).pageNum=l),limit:o(p).pageSize,"onUpdate:limit":n[4]||(n[4]=l=>o(p).pageSize=l),onPagination:I},null,8,["total","page","limit"]),[[G,o(T)>0]]),e(K,{title:o(F),modelValue:o(w),"onUpdate:modelValue":n[8]||(n[8]=l=>$(w)?w.value=l:null),width:"500px","append-to-body":""},{footer:a(()=>[t("div",Me,[e(v,{onClick:de},{default:a(()=>[g("驳回退款请求")]),_:1}),e(v,{type:"primary",onClick:re},{default:a(()=>[g("同意退款请求")]),_:1}),e(v,{onClick:oe},{default:a(()=>[g("取 消")]),_:1})])]),default:a(()=>[e(L,{ref:"manageOrdersRef",model:o(f),rules:o(ee),"label-width":"80px"},{default:a(()=>[e(V,{label:"订单号",prop:"orderId"},{default:a(()=>[e(h,{modelValue:o(f).orderId,"onUpdate:modelValue":n[5]||(n[5]=l=>o(f).orderId=l),readonly:""},null,8,["modelValue"])]),_:1}),e(V,{label:"支付金额",prop:"paymentAmount"},{default:a(()=>[e(h,{modelValue:o(f).paymentAmount,"onUpdate:modelValue":n[6]||(n[6]=l=>o(f).paymentAmount=l),readonly:""},null,8,["modelValue"])]),_:1}),e(V,{label:"支付方式",prop:"paymentMethod"},{default:a(()=>[e(h,{modelValue:o(f).payments.paymentMethod,"onUpdate:modelValue":n[7]||(n[7]=l=>o(f).payments.paymentMethod=l),readonly:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(K,{title:o(z),modelValue:o(A),"onUpdate:modelValue":n[10]||(n[10]=l=>$(A)?A.value=l:null),width:"600px","append-to-body":""},{footer:a(()=>[t("div",Rt,[e(v,{onClick:n[9]||(n[9]=l=>A.value=!1)},{default:a(()=>[g("关 闭")]),_:1})])]),default:a(()=>[e(he,{class:Oe(["order-detail-card",ae(o(d).orderStatus)])},{default:a(()=>[t("div",$e,[t("div",Be,[t("h3",null,"订单详情 #"+r(o(d).orderId),1),e(fe,{options:o(J),value:o(d).orderStatus,style:{"margin-left":"15px"}},null,8,["options","value"])]),t("div",Fe,[t("span",null,"创建时间: "+r(s.parseTime(o(d).createdAt,"{y}-{m}-{d} {h}:{i}:{s}")),1)])]),e(D),e(y,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[t("div",ze,[Ee,t("span",Le,r(o(d).userId),1)])]),_:1}),e(c,{span:12},{default:a(()=>{var l;return[t("div",je,[Ke,t("span",Qe,r(((l=o(U).find(S=>S.productId===o(d).productId))==null?void 0:l.title)||o(d).productId),1)])]}),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[t("div",Ge,[He,t("span",We,r(s.parseTime(o(d).departureDate,"{y}-{m}-{d}")),1)])]),_:1}),e(c,{span:12},{default:a(()=>[t("div",Je,[Xe,t("span",Ye,r(o(d).contactName),1)])]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[t("div",Ze,[et,t("span",tt,r(o(d).contactPhone),1)])]),_:1}),e(c,{span:12},{default:a(()=>[t("div",at,[ot,t("span",lt,r(o(d).contactEmail||"-"),1)])]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[t("div",nt,[st,t("span",dt,r(o(d).adultCount||0),1)])]),_:1}),e(c,{span:12},{default:a(()=>[t("div",rt,[it,t("span",ut,r(o(d).childCount||0),1)])]),_:1})]),_:1}),e(D),t("div",ct,[e(y,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[t("div",pt,[_t,t("span",mt,"¥"+r(o(d).totalAmount),1)])]),_:1}),e(c,{span:12},{default:a(()=>[t("div",ft,[gt,t("span",ht,"-¥"+r(o(d).discountAmount||0),1)])]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>[t("div",vt,[bt,t("span",yt,"¥"+r(o(d).paymentAmount),1)])]),_:1}),e(c,{span:12},{default:a(()=>{var l;return[t("div",wt,[It,t("span",Vt,r(((l=o(d).payments)==null?void 0:l.paymentMethod)||"-"),1)])]}),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(c,{span:12},{default:a(()=>{var l;return[t("div",St,[Ct,t("span",At,r((l=o(d).payments)!=null&&l.paidAt?s.parseTime(o(d).payments.paidAt,"{y}-{m}-{d} {h}:{i}:{s}"):"-"),1)])]}),_:1})]),_:1})]),e(D),t("div",Ot,[kt,e(j,{data:o(d).orderTravelers,style:{width:"100%","margin-top":"15px"},border:""},{default:a(()=>[e(m,{label:"姓名",prop:"realName",align:"center"}),e(m,{label:"类型",align:"center"},{default:a(l=>[e(ge,{type:l.row.isAdult===1?"primary":"success"},{default:a(()=>[g(r(l.row.isAdult===1?"成人":"儿童"),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"性别",align:"center"},{default:a(l=>[t("span",null,r(l.row.gender===1?"男":"女"),1)]),_:1}),e(m,{label:"出生日期",prop:"birthdate",align:"center"},{default:a(l=>[t("span",null,r(l.row.birthdate||"-"),1)]),_:1}),e(m,{label:"护照号",prop:"passportNumber",align:"center"},{default:a(l=>[t("span",null,r(l.row.passportNumber||"-"),1)]),_:1})]),_:1},8,["data"])]),e(D),t("div",xt,[t("div",Nt,[Dt,t("span",qt,r(o(d).note||"无备注"),1)])])]),_:1},8,["class"])]),_:1},8,["title","modelValue"])])}}}),Ft=ye(Tt,[["__scopeId","data-v-ae4f19f2"]]);export{Ft as default};
