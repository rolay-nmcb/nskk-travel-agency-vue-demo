import{C as ge,d as be,r as m,O as ye,T as Ie,w as ke,e as u,R as O,c as f,o as d,H as V,h as l,S as H,B as t,i as a,l as Ve,F as h,D,j as y,m as s,P as G,k as J,A as P,f as W}from"./index-Lq3EucIc.js";import{l as Se,a as Pe,u as we,b as he}from"./productInventory-BN_jAqQY.js";import{l as X}from"./page-lV5IMbY_.js";import{l as De}from"./products-CBA54OiK.js";const Ce={class:"app-container"},Ae={key:0},Ue={key:0},xe={class:"dialog-footer"},Ne=ge({name:"ProductInventory"}),Ee=Object.assign(Ne,{setup(qe){const{proxy:I}=be(),{sale_status:U}=I.useDict("sale_status"),E=m([]),_=m(!1),x=m(!0),C=m(!0),F=m([]),T=m(!0),Z=m(!0),N=m(0),q=m(""),L=ye({form:{},queryParams:{pageNum:1,pageSize:10,productId:null,departureDate:null,availableStock:null,isActive:null},rules:{productId:[{required:!0,message:"产品ID不能为空",trigger:"blur"}],departureDate:[{required:!0,message:"出发日期不能为空",trigger:"blur"}],adultPrice:[{required:!0,message:"成人价格不能为空",trigger:"blur"}],childPrice:[{required:!0,message:"儿童价格不能为空",trigger:"blur"}],initialStock:[{required:!0,message:"初始库存不能为空",trigger:"blur"}],availableStock:[{required:!0,message:"可用库存不能为空",trigger:"blur"},{validator(r,o,c){const p=Number(L.form.initialStock);Number(o)>p?c(new Error("可用库存不能大于初始库存")):c()},trigger:"blur"}]}}),{queryParams:i,form:n,rules:ee}=Ie(L);function S(){x.value=!0,Se(i.value).then(r=>{E.value=r.rows,N.value=r.total,x.value=!1})}function le(){_.value=!1,R()}function R(){n.value={inventoryId:null,productId:null,productName:"",departureDate:null,adultPrice:null,childPrice:null,initialStock:null,availableStock:null,isActive:null,createdAt:null,updatedAt:null},I.resetForm("productInventoryRef")}function te(){const r=w.value.find(o=>o.productId===n.value.productId);n.value.productName=r?r.title:""}ke(()=>n.value.productId,()=>{te()});function $(){i.value.pageNum=1,S()}function ae(){I.resetForm("queryRef"),$()}function oe(r){F.value=r.map(o=>o.inventoryId),T.value=r.length!=1,Z.value=!r.length}function ne(){R(),_.value=!0,q.value="添加产品库存价格"}function M(r){R();const o=r.inventoryId||F.value;Pe(o).then(c=>{n.value=c.data,_.value=!0,q.value="修改产品库存价格"})}function re(){I.$refs.productInventoryRef.validate(r=>{r&&(n.value.inventoryId!=null?we(n.value).then(o=>{I.$modal.msgSuccess("修改成功"),_.value=!1,S()}):he(n.value).then(o=>{I.$modal.msgSuccess("新增成功"),_.value=!1,S()}))})}function ue(){I.download("manage/productInventory/export",{...i.value},`productInventory_${new Date().getTime()}.xlsx`)}const w=m([]);function de(){X.status="1",De(X).then(r=>{w.value=r.rows})}return S(),de(),(r,o)=>{const c=u("el-input"),p=u("el-form-item"),Y=u("el-date-picker"),z=u("el-option"),Q=u("el-select"),g=u("el-button"),j=u("el-form"),k=u("el-col"),ie=u("right-toolbar"),B=u("el-row"),v=u("el-table-column"),K=u("el-tag"),pe=u("dict-tag"),se=u("el-table"),ce=u("pagination"),me=u("el-radio"),fe=u("el-radio-group"),ve=u("el-dialog"),A=O("hasPermi"),_e=O("loading");return d(),f("div",Ce,[V(l(j,{model:t(i),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[l(p,{label:"产品编号",prop:"productId"},{default:a(()=>[l(c,{modelValue:t(i).productId,"onUpdate:modelValue":o[0]||(o[0]=e=>t(i).productId=e),placeholder:"请输入产品编号",clearable:"",onKeyup:Ve($,["enter"])},null,8,["modelValue"])]),_:1}),l(p,{label:"出发日期",prop:"departureDate"},{default:a(()=>[l(Y,{clearable:"",modelValue:t(i).departureDate,"onUpdate:modelValue":o[1]||(o[1]=e=>t(i).departureDate=e),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择出发日期"},null,8,["modelValue"])]),_:1}),l(p,{label:"是否可售",prop:"isActive"},{default:a(()=>[l(Q,{modelValue:t(i).isActive,"onUpdate:modelValue":o[2]||(o[2]=e=>t(i).isActive=e),placeholder:"请选择是否可售",clearable:""},{default:a(()=>[(d(!0),f(h,null,D(t(U),e=>(d(),y(z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[l(g,{type:"primary",icon:"Search",onClick:$},{default:a(()=>[s("搜索")]),_:1}),l(g,{icon:"Refresh",onClick:ae},{default:a(()=>[s("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[H,t(C)]]),l(B,{gutter:10,class:"mb8"},{default:a(()=>[l(k,{span:1.5},{default:a(()=>[V((d(),y(g,{type:"primary",plain:"",icon:"Plus",onClick:ne},{default:a(()=>[s("新增")]),_:1})),[[A,["manage:productInventory:add"]]])]),_:1}),l(k,{span:1.5},{default:a(()=>[V((d(),y(g,{type:"success",plain:"",icon:"Edit",disabled:t(T),onClick:M},{default:a(()=>[s("修改")]),_:1},8,["disabled"])),[[A,["manage:productInventory:edit"]]])]),_:1}),l(k,{span:1.5},{default:a(()=>[V((d(),y(g,{type:"warning",plain:"",icon:"Download",onClick:ue},{default:a(()=>[s("导出")]),_:1})),[[A,["manage:productInventory:export"]]])]),_:1}),l(ie,{showSearch:t(C),"onUpdate:showSearch":o[3]||(o[3]=e=>G(C)?C.value=e:null),onQueryTable:S},null,8,["showSearch"])]),_:1}),V((d(),y(se,{data:t(E),onSelectionChange:oe},{default:a(()=>[l(v,{type:"selection",width:"55",align:"center"}),l(v,{label:"序号",align:"center",prop:"inventoryId",type:"index",width:"50"}),l(v,{label:"产品名称",align:"center",prop:"productId"},{default:a(e=>[(d(!0),f(h,null,D(t(w),b=>(d(),f("span",{key:b.productId},[b.productId===e.row.productId?(d(),f("span",Ae,P(b.title),1)):J("",!0)]))),128))]),_:1}),l(v,{label:"出发日期",align:"center",prop:"departureDate",width:"180"},{default:a(e=>[W("span",null,P(r.parseTime(e.row.departureDate,"{y}-{m}-{d}")),1)]),_:1}),l(v,{label:"成人价格",align:"center",prop:"adultPrice"},{default:a(e=>[l(K,null,{default:a(()=>[s("¥"+P(e.row.adultPrice),1)]),_:2},1024)]),_:1}),l(v,{label:"儿童价格",align:"center",prop:"childPrice"},{default:a(e=>[l(K,null,{default:a(()=>[s("¥"+P(e.row.childPrice),1)]),_:2},1024)]),_:1}),l(v,{label:"库存数量",align:"center",prop:"availableStock"}),l(v,{label:"是否可售",align:"center",prop:"isActive"},{default:a(e=>[l(pe,{options:t(U),value:e.row.isActive},null,8,["options","value"])]),_:1}),l(v,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(e=>[V((d(),y(g,{link:"",type:"primary",icon:"Edit",onClick:b=>M(e.row)},{default:a(()=>[s("修改")]),_:2},1032,["onClick"])),[[A,["manage:productInventory:edit"]]])]),_:1})]),_:1},8,["data"])),[[_e,t(x)]]),V(l(ce,{total:t(N),page:t(i).pageNum,"onUpdate:page":o[4]||(o[4]=e=>t(i).pageNum=e),limit:t(i).pageSize,"onUpdate:limit":o[5]||(o[5]=e=>t(i).pageSize=e),onPagination:S},null,8,["total","page","limit"]),[[H,t(N)>0]]),l(ve,{title:t(q),modelValue:t(_),"onUpdate:modelValue":o[17]||(o[17]=e=>G(_)?_.value=e:null),width:"500px","append-to-body":""},{footer:a(()=>[W("div",xe,[l(g,{type:"primary",onClick:re},{default:a(()=>[s("确 定")]),_:1}),l(g,{onClick:le},{default:a(()=>[s("取 消")]),_:1})])]),default:a(()=>[l(j,{ref:"productInventoryRef",model:t(n),rules:t(ee),"label-width":"80px"},{default:a(()=>[l(p,{label:"产品编号",prop:"productId"},{default:a(()=>[l(Q,{modelValue:t(n).productId,"onUpdate:modelValue":o[6]||(o[6]=e=>t(n).productId=e),placeholder:"请选择产品",clearable:"",filterable:""},{default:a(()=>[(d(!0),f(h,null,D(t(w),e=>(d(),y(z,{key:e.productId,label:e.title,value:e.productId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"产品名称"},{default:a(e=>[(d(!0),f(h,null,D(t(w),b=>(d(),f("span",{key:b.productId},[t(n).productId===b.productId?(d(),f("span",Ue,P(b.title),1)):J("",!0)]))),128))]),_:1}),l(p,{label:"出发日期",prop:"departureDate"},{default:a(()=>[l(Y,{clearable:"",modelValue:t(n).departureDate,"onUpdate:modelValue":o[7]||(o[7]=e=>t(n).departureDate=e),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择出发日期"},null,8,["modelValue"])]),_:1}),l(B,{gutter:16},{default:a(()=>[l(k,{span:12},{default:a(()=>[l(p,{label:"成人价格",prop:"adultPrice"},{default:a(()=>[l(c,{modelValue:t(n).adultPrice,"onUpdate:modelValue":o[8]||(o[8]=e=>t(n).adultPrice=e),type:"number",placeholder:"请输入成人价格",onInput:o[9]||(o[9]=e=>t(n).adultPrice=String(t(n).adultPrice).replace(/[^\d]/g,""))},null,8,["modelValue"])]),_:1})]),_:1}),l(k,{span:12},{default:a(()=>[l(p,{label:"儿童价格",prop:"childPrice"},{default:a(()=>[l(c,{modelValue:t(n).childPrice,"onUpdate:modelValue":o[10]||(o[10]=e=>t(n).childPrice=e),type:"number",placeholder:"请输入儿童价格",onInput:o[11]||(o[11]=e=>t(n).childPrice=String(t(n).childPrice).replace(/[^\d]/g,""))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(B,{gutter:16},{default:a(()=>[l(k,{span:12},{default:a(()=>[l(p,{label:"初始库存",prop:"initialStock"},{default:a(()=>[l(c,{modelValue:t(n).initialStock,"onUpdate:modelValue":o[12]||(o[12]=e=>t(n).initialStock=e),type:"number",placeholder:"请输入初始库存",disabled:t(n).inventoryId!=null,onInput:o[13]||(o[13]=e=>t(n).initialStock=String(t(n).initialStock).replace(/[^\d]/g,""))},null,8,["modelValue","disabled"])]),_:1})]),_:1}),l(k,{span:12},{default:a(()=>[l(p,{label:"可用库存",prop:"availableStock"},{default:a(()=>[l(c,{modelValue:t(n).availableStock,"onUpdate:modelValue":o[14]||(o[14]=e=>t(n).availableStock=e),type:"number",placeholder:"请输入可用库存",onInput:o[15]||(o[15]=e=>t(n).availableStock=String(t(n).availableStock).replace(/[^\d]/g,""))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(p,{label:"是否可售",prop:"isActive"},{default:a(()=>[l(fe,{modelValue:t(n).isActive,"onUpdate:modelValue":o[16]||(o[16]=e=>t(n).isActive=e)},{default:a(()=>[(d(!0),f(h,null,D(t(U),e=>(d(),y(me,{key:e.value,label:parseInt(e.value)},{default:a(()=>[s(P(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Ee as default};
