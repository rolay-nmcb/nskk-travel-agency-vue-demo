import{_ as T,d as U,u as q,a as S,r as p,v as x,w as A,e as _,c,f as t,m as B,k as F,H as L,I as M,h as f,A as R,F as j,D as z,s as E,t as H,o as u}from"./index-CqU5sET7.js";import{g as G,u as J,a as K}from"./travelNotesUser-B8bKppJE.js";import{l as O}from"./destinations-CNa6kP2I.js";const i=d=>(E("data-v-8a7e283c"),d=d(),H(),d),W={class:"travel-note-container"},X={class:"navbar"},Y={class:"navbar-content"},Z=i(()=>t("i",{class:"icon-arrow-left"},null,-1)),P=i(()=>t("h1",null,"写游记",-1)),Q={class:"main-content"},ee={class:"form-group title-input"},te={class:"form-group"},se=i(()=>t("label",{class:"form-label"},"目的地",-1)),ae={class:"form-group"},oe=i(()=>t("label",{class:"form-label"},"封面图",-1)),ne={class:"upload-container"},le=i(()=>t("p",{class:"upload-hint"},"上传多张图片，第一张将作为封面图（最多5张）",-1)),ie={class:"form-group content-editor"},re=i(()=>t("label",{class:"form-label"},"游记内容",-1)),de={class:"word-count"},ce={key:0,class:"preview-section"},ue=i(()=>t("h3",null,"图片预览",-1)),ve={class:"image-preview"},me=["src","alt"],pe=["onClick"],_e=i(()=>t("i",{class:"icon-delete"},null,-1)),fe=[_e],Ie=i(()=>t("footer",{class:"footer-hint"},[t("p",null,"发布后将进入审核流程，审核通过后将公开发布")],-1)),ge={__name:"create",setup(d){const{proxy:l}=U(),r=q(),I=S(),e=p({noteId:null,userId:null,title:"",content:"",coverImage:"",destinationId:"",destinationIds:null,status:0,viewCount:0,likeCount:0,isFeatured:0}),k=p([]);function g(a,s=null){return a.filter(o=>o.parentId===s).map(o=>({...o,children:g(a,o.destinationId)}))}const v=p([]);function w(){O({pageNum:1,pageSize:1e4}).then(a=>{k.value=a.data,v.value=g(a.data),console.log(v.value)})}x(()=>{w(),r.query.userId&&(e.value.userId=r.query.userId),r.query.noteId&&y(r.query.noteId,r.query.userId)}),A(()=>r.query,a=>{a.userId&&a.userId!==e.value.userId&&(e.value.userId=a.userId)});const y=(a,s)=>{G(a,s).then(o=>{o.code==200&&(e.value=o.data,e.value.destinationIds=o.data.destinationId)}).catch(o=>{console.error("获取游记详情失败",o),l.$message.error("加载游记失败，请重试")})},V=()=>{b()&&(e.value.status=0,h())},$=()=>{b(!0)&&(e.value.status=1,h(!0))},h=(a=!1)=>{e.value.destinationIds&&(Array.isArray(e.value.destinationIds)?e.value.destinationId=e.value.destinationIds.slice(-1)[0]:(typeof e.value.destinationIds=="number"||typeof e.value.destinationIds=="string")&&(e.value.destinationId=e.value.destinationIds),e.value.destinationIds=null),e.value.noteId?J(e.value).then(s=>{s.code===200&&(l.$message.success(a?"更新成功，等待审核":"草稿保存成功"),I.back())}).catch(s=>{console.error("更新游记失败",s),l.$message.error("更新失败，请重试")}):K(e.value).then(s=>{s.code===200&&(l.$message.success(a?"发布成功，等待审核":"草稿保存成功"),I.back())}).catch(s=>{console.error("保存游记失败",s),l.$message.error("保存失败，请重试")})},b=(a=!1)=>e.value.title.trim()?a&&!e.value.destinationIds?(l.$message.warning("请选择目的地"),!1):a&&!e.value.coverImage?(l.$message.warning("请上传至少一张封面图"),!1):e.value.content.trim()?!0:(l.$message.warning("请填写游记内容"),!1):(l.$message.warning("请输入游记标题"),!1),C=a=>{const s=e.value.coverImage.split(",");s.splice(a,1),e.value.coverImage=s.join(",")};return(a,s)=>{const o=_("el-cascader"),N=_("image-upload"),D=_("editor");return u(),c("div",W,[t("nav",X,[t("div",Y,[t("button",{class:"back-btn",onClick:s[0]||(s[0]=n=>a.$router.back())},[Z,B(" 返回 ")]),P,t("div",{class:"action-buttons"},[t("button",{class:"btn draft-btn",onClick:V},"保存草稿"),t("button",{class:"btn publish-btn",onClick:$},"发布")])])]),t("main",Q,[t("div",ee,[L(t("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=n=>e.value.title=n),placeholder:"给你的游记起个吸引人的标题吧~",class:"title-text"},null,512),[[M,e.value.title]])]),t("div",te,[se,f(o,{modelValue:e.value.destinationIds,"onUpdate:modelValue":s[2]||(s[2]=n=>e.value.destinationIds=n),placeholder:"请选择目的地",clearable:"",options:v.value,"show-all-levels":!1,props:{label:"name",value:"destinationId",children:"children",checkStrictly:!0}},null,8,["modelValue","options"])]),t("div",ae,[oe,t("div",ne,[f(N,{modelValue:e.value.coverImage,"onUpdate:modelValue":s[3]||(s[3]=n=>e.value.coverImage=n),multiple:"",class:"image-uploader"},null,8,["modelValue"]),le])]),t("div",ie,[re,f(D,{modelValue:e.value.content,"onUpdate:modelValue":s[4]||(s[4]=n=>e.value.content=n),placeholder:"分享你的旅行故事吧...可以写下行程安排、美食推荐、心得体会等",rows:"15"},null,8,["modelValue"]),t("div",de,R(e.value.content.length)+" 字 ",1)]),e.value.coverImage&&e.value.coverImage.length?(u(),c("div",ce,[ue,t("div",ve,[(u(!0),c(j,null,z(e.value.coverImage.split(","),(n,m)=>(u(),c("div",{key:m,class:"preview-item"},[t("img",{src:n,alt:"图片"+(m+1)},null,8,me),t("button",{class:"delete-img",onClick:he=>C(m)},fe,8,pe)]))),128))])])):F("",!0)]),Ie])}}},ye=T(ge,[["__scopeId","data-v-8a7e283c"]]);export{ye as default};
