import{_ as De,C as Se,d as Ve,r as _,O as Ce,T as Ae,e as u,R as H,c as W,o as D,H as C,h as e,S as J,B as l,i as a,l as X,m as g,j as N,P as $,f as t,A as s,a1 as Oe,F as Ne,D as ke,G as xe,s as qe,t as Pe}from"./index-Lq3EucIc.js";import{l as Te,g as Y,u as Ue,a as Re}from"./manageOrders-DjJZIfBR.js";import{l as Fe}from"./page-lV5IMbY_.js";import{l as $e}from"./products-CBA54OiK.js";import{g as Le}from"./productInventory-BN_jAqQY.js";const c=k=>(qe("data-v-dc40b48f"),k=k(),Pe(),k),Me={class:"app-container"},Be=c(()=>t("span",null,"出发日期",-1)),Ee={class:"card-header"},ze=c(()=>t("h3",null,"订单改签",-1)),Ke={class:"order-id"},Qe=c(()=>t("i",{class:"el-icon-date"},null,-1)),je={class:"dialog-footer"},Ge={class:"order-header"},He={class:"order-title"},We={class:"order-meta"},Je={class:"info-item"},Xe=c(()=>t("span",{class:"info-label"},"用户ID:",-1)),Ye={class:"info-value"},Ze={class:"info-item"},et=c(()=>t("span",{class:"info-label"},"产品名称:",-1)),tt={class:"info-value"},at={class:"info-item"},lt=c(()=>t("span",{class:"info-label"},"出发日期:",-1)),ot={class:"info-value"},nt={class:"info-item"},st=c(()=>t("span",{class:"info-label"},"联系人:",-1)),rt={class:"info-value"},dt={class:"info-item"},it=c(()=>t("span",{class:"info-label"},"联系电话:",-1)),ut={class:"info-value"},ct={class:"info-item"},pt=c(()=>t("span",{class:"info-label"},"联系邮箱:",-1)),_t={class:"info-value"},mt={class:"info-item"},ft=c(()=>t("span",{class:"info-label"},"成人数:",-1)),gt={class:"info-value"},ht={class:"info-item"},vt=c(()=>t("span",{class:"info-label"},"儿童数:",-1)),bt={class:"info-value"},wt={class:"price-section"},yt={class:"info-item"},It=c(()=>t("span",{class:"info-label"},"订单总额:",-1)),Dt={class:"info-value price"},St={class:"info-item"},Vt=c(()=>t("span",{class:"info-label"},"优惠金额:",-1)),Ct={class:"info-value price discount"},At={class:"info-item"},Ot=c(()=>t("span",{class:"info-label"},"支付金额:",-1)),Nt={class:"info-value price final"},kt={class:"info-item"},xt=c(()=>t("span",{class:"info-label"},"支付方式:",-1)),qt={class:"info-value"},Pt={class:"info-item"},Tt=c(()=>t("span",{class:"info-label"},"支付时间:",-1)),Ut={class:"info-value"},Rt={class:"travelers-section"},Ft=c(()=>t("h4",null,"出行人信息",-1)),$t={class:"note-section"},Lt={class:"info-item"},Mt=c(()=>t("span",{class:"info-label"},"改签备注:",-1)),Bt={class:"info-value"},Et={class:"dialog-footer"},zt=Se({name:"ManageOrders"}),Kt=Object.assign(zt,{setup(k){const{proxy:h}=Ve(),{order_status:Z}=h.useDict("order_status"),L=_([]),I=_(!1),P=_(!0),x=_(!0),T=_([]),ee=_(!0),te=_(!0),U=_(0),M=_(""),A=_(!1),B=_(""),r=_({}),ae=Ce({form:{},queryParams:{pageNum:1,pageSize:10,userId:null,productId:null,orderId:null,departureDate:null,orderStatus:null,contactName:null},rules:{userId:[{required:!0,message:"用户ID不能为空",trigger:"blur"}],productId:[{required:!0,message:"产品ID不能为空",trigger:"blur"}],departureDate:[{required:!0,message:"出发日期不能为空",trigger:"blur"}],totalAmount:[{required:!0,message:"订单总额不能为空",trigger:"blur"}],paymentAmount:[{required:!0,message:"支付金额不能为空",trigger:"blur"}],contactName:[{required:!0,message:"联系人姓名不能为空",trigger:"blur"}],contactPhone:[{required:!0,message:"联系人电话不能为空",trigger:"blur"}]}}),{queryParams:m,form:i,rules:le}=Ae(ae);function S(){P.value=!0,m.value.orderStatus="6",Te(m.value).then(d=>{L.value=d.rows,U.value=d.total,P.value=!1})}function oe(d){const n=d.orderId||T.value;Y(n).then(v=>{r.value=v.data,A.value=!0,B.value="订单详情"})}function ne(d){switch(d){case"0":return"pending";case"1":return"paid";case"2":return"completed";case"3":return"cancelled";default:return""}}function se(){I.value=!1,E()}function E(){i.value={orderId:null,userId:null,productId:null,departureDate:null,adultCount:null,childCount:null,totalAmount:null,discountAmount:null,paymentAmount:null,orderStatus:null,contactName:null,orderStatus:null,contactPhone:null,contactEmail:null,note:null,createdAt:null,paidAt:null,cancelledAt:null},h.resetForm("manageOrdersRef")}function q(){m.value.pageNum=1,S()}function re(){h.resetForm("queryRef"),q()}function de(d){T.value=d.map(n=>n.orderId),ee.value=d.length!=1,te.value=!d.length}const z=_([]);function ie(d){E();const n=d.orderId||T.value;Y(n).then(v=>{i.value=v.data,i.value.newDepartureDate=null,Le(i.value.productId).then(b=>{z.value=b.data}),I.value=!0,M.value="订单改签"})}function ue(){h.$refs.manageOrdersRef.validate(d=>{d&&(i.value.newDepartureDate?(i.value.departureDate=i.value.newDepartureDate,delete i.value.newDepartureDate,i.value.orderId!=null?(i.value.orderStatus="2",Ue(i.value).then(n=>{h.$modal.msgSuccess("改签成功"),I.value=!1,S()})):Re(i.value).then(n=>{h.$modal.msgSuccess("新增成功"),I.value=!1,S()})):h.$modal.msgWarning("请选择新的出发日期"))})}function ce(){h.download("manage/manageOrders/export",{...m.value},`manageOrders_${new Date().getTime()}.xlsx`)}const R=_([]);function pe(){$e(Fe).then(d=>{R.value=d.rows})}return S(),pe(),(d,n)=>{const v=u("el-input"),b=u("el-form-item"),w=u("el-button"),K=u("el-form"),p=u("el-col"),_e=u("right-toolbar"),y=u("el-row"),f=u("el-table-column"),me=u("el-icon"),fe=u("el-tooltip"),Q=u("el-table"),ge=u("pagination"),O=u("el-divider"),he=u("el-option"),ve=u("el-select"),j=u("el-card"),G=u("el-dialog"),be=u("dict-tag"),we=u("el-tag"),F=H("hasPermi"),ye=H("loading");return D(),W("div",Me,[C(e(K,{model:l(m),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[e(b,{label:"订单号",prop:"orderId"},{default:a(()=>[e(v,{modelValue:l(m).orderId,"onUpdate:modelValue":n[0]||(n[0]=o=>l(m).orderId=o),placeholder:"请输入订单号",clearable:"",onKeyup:X(q,["enter"])},null,8,["modelValue"])]),_:1}),e(b,{label:"联系人",prop:"contactName"},{default:a(()=>[e(v,{modelValue:l(m).contactName,"onUpdate:modelValue":n[1]||(n[1]=o=>l(m).contactName=o),placeholder:"请输入联系人",clearable:"",onKeyup:X(q,["enter"])},null,8,["modelValue"])]),_:1}),e(b,null,{default:a(()=>[e(w,{type:"primary",icon:"Search",onClick:q},{default:a(()=>[g("搜索")]),_:1}),e(w,{icon:"Refresh",onClick:re},{default:a(()=>[g("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[J,l(x)]]),e(y,{gutter:10,class:"mb8"},{default:a(()=>[e(p,{span:1.5},{default:a(()=>[C((D(),N(w,{type:"warning",plain:"",icon:"Download",onClick:ce},{default:a(()=>[g("导出")]),_:1})),[[F,["manage:manageOrders:export"]]])]),_:1}),e(_e,{showSearch:l(x),"onUpdate:showSearch":n[2]||(n[2]=o=>$(x)?x.value=o:null),onQueryTable:S},null,8,["showSearch"])]),_:1}),C((D(),N(Q,{data:l(L),onSelectionChange:de},{default:a(()=>[e(f,{type:"selection",width:"55",align:"center"}),e(f,{label:"订单号",align:"center",prop:"orderId"}),e(f,{label:"用户编号",align:"center",prop:"userId"}),e(f,{label:"产品名称",align:"center",prop:"productId"},{default:a(o=>{var V;return[t("span",null,s(((V=l(R).find(Ie=>Ie.productId===o.row.productId))==null?void 0:V.title)||o.row.productId),1)]}),_:1}),e(f,{label:"出发日期",align:"center",prop:"departureDate",width:"180"},{header:a(()=>[Be,e(fe,{content:"若非旅行服务出发日期代表但不限于使用日期，签发日期等",placement:"top"},{default:a(()=>[e(me,{style:{"margin-left":"5px",color:"#409EFF",cursor:"pointer"}},{default:a(()=>[e(l(Oe))]),_:1})]),_:1})]),default:a(o=>[t("span",null,s(d.parseTime(o.row.departureDate,"{y}-{m}-{d}")),1)]),_:1}),e(f,{label:"改签要求",align:"center",prop:"note","show-overflow-tooltip":""}),e(f,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(o=>[C((D(),N(w,{link:"",type:"primary",icon:"View",onClick:V=>oe(o.row)},{default:a(()=>[g("查看订单详细")]),_:2},1032,["onClick"])),[[F,["manage:manageOrders:query"]]]),C((D(),N(w,{link:"",type:"primary",icon:"Switch",onClick:V=>ie(o.row)},{default:a(()=>[g("处理改签")]),_:2},1032,["onClick"])),[[F,["manage:manageOrders:query"]]])]),_:1})]),_:1},8,["data"])),[[ye,l(P)]]),C(e(ge,{total:l(U),page:l(m).pageNum,"onUpdate:page":n[3]||(n[3]=o=>l(m).pageNum=o),limit:l(m).pageSize,"onUpdate:limit":n[4]||(n[4]=o=>l(m).pageSize=o),onPagination:S},null,8,["total","page","limit"]),[[J,l(U)>0]]),e(G,{title:l(M),modelValue:l(I),"onUpdate:modelValue":n[8]||(n[8]=o=>$(I)?I.value=o:null),width:"500px","append-to-body":""},{footer:a(()=>[t("div",je,[e(w,{onClick:se},{default:a(()=>[g("取 消")]),_:1}),e(w,{type:"primary",onClick:ue},{default:a(()=>[g("确 定")]),_:1})])]),default:a(()=>[e(j,{class:"change-order-card"},{default:a(()=>[t("div",Ee,[ze,t("p",Ke,"订单号: "+s(l(i).orderId),1)]),e(O),e(K,{ref:"manageOrdersRef",model:l(i),rules:l(le),"label-width":"100px","label-position":"top"},{default:a(()=>[e(b,{label:"原出发日期"},{default:a(()=>[e(v,{modelValue:l(i).departureDate,"onUpdate:modelValue":n[5]||(n[5]=o=>l(i).departureDate=o),disabled:""},{prepend:a(()=>[Qe]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"可选出发日期",prop:"newDepartureDate"},{default:a(()=>[e(ve,{modelValue:l(i).newDepartureDate,"onUpdate:modelValue":n[6]||(n[6]=o=>l(i).newDepartureDate=o),placeholder:"请选择新的出发日期",clearable:"",style:{width:"100%"}},{default:a(()=>[(D(!0),W(Ne,null,ke(l(z),o=>(D(),N(he,{key:o,label:d.parseTime(o,"{y}-{m}-{d}"),value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"改签备注",prop:"note"},{default:a(()=>[e(v,{modelValue:l(i).note,"onUpdate:modelValue":n[7]||(n[7]=o=>l(i).note=o),type:"textarea",placeholder:"请输入改签备注（选填）",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["title","modelValue"]),e(G,{title:l(B),modelValue:l(A),"onUpdate:modelValue":n[10]||(n[10]=o=>$(A)?A.value=o:null),width:"600px","append-to-body":""},{footer:a(()=>[t("div",Et,[e(w,{onClick:n[9]||(n[9]=o=>A.value=!1)},{default:a(()=>[g("关 闭")]),_:1})])]),default:a(()=>[e(j,{class:xe(["order-detail-card",ne(l(r).orderStatus)])},{default:a(()=>[t("div",Ge,[t("div",He,[t("h3",null,"订单详情 #"+s(l(r).orderId),1),e(be,{options:l(Z),value:l(r).orderStatus,style:{"margin-left":"15px"}},null,8,["options","value"])]),t("div",We,[t("span",null,"创建时间: "+s(d.parseTime(l(r).createdAt,"{y}-{m}-{d} {h}:{i}:{s}")),1)])]),e(O),e(y,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[t("div",Je,[Xe,t("span",Ye,s(l(r).userId),1)])]),_:1}),e(p,{span:12},{default:a(()=>{var o;return[t("div",Ze,[et,t("span",tt,s(((o=l(R).find(V=>V.productId===l(r).productId))==null?void 0:o.title)||l(r).productId),1)])]}),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[t("div",at,[lt,t("span",ot,s(d.parseTime(l(r).departureDate,"{y}-{m}-{d}")),1)])]),_:1}),e(p,{span:12},{default:a(()=>[t("div",nt,[st,t("span",rt,s(l(r).contactName),1)])]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[t("div",dt,[it,t("span",ut,s(l(r).contactPhone),1)])]),_:1}),e(p,{span:12},{default:a(()=>[t("div",ct,[pt,t("span",_t,s(l(r).contactEmail||"-"),1)])]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[t("div",mt,[ft,t("span",gt,s(l(r).adultCount||0),1)])]),_:1}),e(p,{span:12},{default:a(()=>[t("div",ht,[vt,t("span",bt,s(l(r).childCount||0),1)])]),_:1})]),_:1}),e(O),t("div",wt,[e(y,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[t("div",yt,[It,t("span",Dt,"¥"+s(l(r).totalAmount),1)])]),_:1}),e(p,{span:12},{default:a(()=>[t("div",St,[Vt,t("span",Ct,"-¥"+s(l(r).discountAmount||0),1)])]),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[t("div",At,[Ot,t("span",Nt,"¥"+s(l(r).paymentAmount),1)])]),_:1}),e(p,{span:12},{default:a(()=>{var o;return[t("div",kt,[xt,t("span",qt,s(((o=l(r).payments)==null?void 0:o.paymentMethod)||"-"),1)])]}),_:1})]),_:1}),e(y,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>{var o;return[t("div",Pt,[Tt,t("span",Ut,s((o=l(r).payments)!=null&&o.paidAt?d.parseTime(l(r).payments.paidAt,"{y}-{m}-{d} {h}:{i}:{s}"):"-"),1)])]}),_:1})]),_:1})]),e(O),t("div",Rt,[Ft,e(Q,{data:l(r).orderTravelers,style:{width:"100%","margin-top":"15px"},border:""},{default:a(()=>[e(f,{label:"姓名",prop:"realName",align:"center"}),e(f,{label:"类型",align:"center"},{default:a(o=>[e(we,{type:o.row.isAdult===1?"primary":"success"},{default:a(()=>[g(s(o.row.isAdult===1?"成人":"儿童"),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"性别",align:"center"},{default:a(o=>[t("span",null,s(o.row.gender===1?"男":"女"),1)]),_:1}),e(f,{label:"出生日期",prop:"birthdate",align:"center"},{default:a(o=>[t("span",null,s(o.row.birthdate||"-"),1)]),_:1}),e(f,{label:"护照号",prop:"passportNumber",align:"center"},{default:a(o=>[t("span",null,s(o.row.passportNumber||"-"),1)]),_:1})]),_:1},8,["data"])]),e(O),t("div",$t,[t("div",Lt,[Mt,t("span",Bt,s(l(r).note||"无备注"),1)])])]),_:1},8,["class"])]),_:1},8,["title","modelValue"])])}}}),Jt=De(Kt,[["__scopeId","data-v-dc40b48f"]]);export{Jt as default};
