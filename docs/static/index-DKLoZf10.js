import{$ as Y,_ as ye,C as Ie,d as we,r as y,O as be,T as Re,u as Ve,v as ke,w as Ce,e as m,R as te,c as p,o as r,H as A,h as a,S as le,B as t,i as n,l as z,F as $,D as F,j as x,m as f,P as O,f as e,A as u,k as D,s as xe,t as Se}from"./index-Lq3EucIc.js";import{l as Me}from"./products-CBA54OiK.js";import{l as De}from"./page-lV5IMbY_.js";function Ue(I){return Y({url:"/manage/reviewsManage/list",method:"get",params:I})}function Ae(I){return Y({url:"/manage/reviewsManage/"+I,method:"get"})}function j(I){return Y({url:"/manage/reviewsManage",method:"put",data:I})}const _=I=>(xe("data-v-73b4743e"),I=I(),Se(),I),$e={class:"app-container"},Fe={class:"reviews-grid"},qe={class:"review-header"},Te={class:"review-basic-info"},Le={class:"review-id"},Pe={class:"user-product-info"},Ne={key:0},He={class:"review-actions"},Be={class:"review-content"},Ee={class:"review-title"},Ke={class:"review-rating"},ze={class:"rating-item"},Oe=_(()=>e("span",{class:"rating-label"},"总体评分:",-1)),je={class:"rating-value"},Ye={class:"review-meta"},Ge={class:"meta-item status"},Je=_(()=>e("span",{class:"meta-label"},"状态:",-1)),We={class:"meta-item"},Xe=_(()=>e("span",{class:"meta-label"},"有用数:",-1)),Ze={class:"meta-item"},Qe=_(()=>e("span",{class:"meta-label"},"创建时间:",-1)),et={class:"core-review-section"},tt={class:"review-title-section"},lt=_(()=>e("div",{class:"section-label"},"评价标题",-1)),at={class:"review-title"},st={class:"review-content-section"},nt=_(()=>e("div",{class:"section-label"},"评价内容",-1)),ot=["innerHTML"],it={class:"review-ratings-section"},dt=_(()=>e("div",{class:"section-label"},"各项评分",-1)),rt={class:"ratings-grid"},ut={class:"rating-item"},ct=_(()=>e("span",{class:"rating-label"},"服务评分",-1)),pt={class:"rating-display"},_t={class:"rating-value"},mt={class:"rating-item"},vt=_(()=>e("span",{class:"rating-label"},"行程安排",-1)),gt={class:"rating-display"},ft={class:"rating-value"},ht={class:"rating-item"},yt=_(()=>e("span",{class:"rating-label"},"住宿评分",-1)),It={class:"rating-display"},wt={class:"rating-value"},bt={class:"rating-item"},Rt=_(()=>e("span",{class:"rating-label"},"餐饮评分",-1)),Vt={class:"rating-display"},kt={class:"rating-value"},Ct={class:"rating-item"},xt=_(()=>e("span",{class:"rating-label"},"交通评分",-1)),St={class:"rating-display"},Mt={class:"rating-value"},Dt={class:"rating-item"},Ut=_(()=>e("span",{class:"rating-label"},"导游评分",-1)),At={class:"rating-display"},$t={class:"rating-value"},Ft={class:"rating-item"},qt=_(()=>e("span",{class:"rating-label"},"性价比评分",-1)),Tt={class:"rating-display"},Lt={class:"rating-value"},Pt={class:"review-images-section"},Nt=_(()=>e("div",{class:"section-label"},"评价图片",-1)),Ht={key:0,class:"image-preview"},Bt={key:1,class:"no-images"},Et={class:"basic-info-section"},Kt=_(()=>e("div",{class:"section-title"},"基本信息",-1)),zt={class:"form-text"},Ot={class:"form-text"},jt={class:"form-text"},Yt={key:0},Gt={class:"form-text"},Jt={class:"form-text"},Wt={class:"form-text"},Xt={class:"form-text"},Zt={class:"reply-section"},Qt=_(()=>e("div",{class:"section-title"},"商家回复",-1)),el=["innerHTML"],tl={key:1,class:"no-reply"},ll={key:2,class:"reply-time"},al={class:"dialog-footer"},sl={class:"dialog-footer"},nl=Ie({name:"ReviewsManage"}),ol=Object.assign(nl,{setup(I){const{proxy:g}=we(),{review_status:L}=g.useDict("review_status"),G=y([]),V=y(!1),S=y(!1),P=y(!0),q=y(!0),ae=y([]);y(!0),y(!0);const N=y(0),J=y(""),se=be({form:{},replyForm:{reviewId:null,replyContent:"",replyAt:null},queryParams:{pageNum:1,pageSize:10,userId:null,productId:null,orderId:null,overallRating:null,serviceRating:null,itineraryRating:null,accommodationRating:null,foodRating:null,transportationRating:null,guideRating:null,valueForMoneyRating:null,isAnonymous:null,status:null},rules:{userId:[{required:!0,message:"用户ID不能为空",trigger:"blur"}],productId:[{required:!0,message:"产品ID不能为空",trigger:"blur"}],orderId:[{required:!0,message:"订单ID不能为空",trigger:"blur"}],overallRating:[{required:!0,message:"总体评分不能为空",trigger:"blur"}]}}),{queryParams:d,form:s,replyForm:b,rules:il}=Re(se),U=Ve();ke(()=>{U.query.orderId&&(d.value.orderId=U.query.orderId,h()),U.query.userId&&(d.value.userId=U.query.userId,h())}),Ce(()=>U.query,i=>{i.orderId&&(d.value.orderId=i.orderId,h()),i.userId&&(d.value.userId=i.userId,h()),i.orderId===void 0&&d.value.orderId&&(d.value.orderId=null,h()),i.userId===void 0&&d.value.userId&&(d.value.userId=null,h())},{immediate:!0,deep:!0});function k(){P.value=!0,Ue(d.value).then(i=>{G.value=i.rows,N.value=i.total,P.value=!1})}function ne(){V.value=!1,W()}function W(){s.value={reviewId:null,userId:null,productId:null,orderId:null,title:null,content:null,overallRating:null,serviceRating:null,itineraryRating:null,accommodationRating:null,foodRating:null,transportationRating:null,guideRating:null,valueForMoneyRating:null,imageUrls:null,isAnonymous:null,status:null,likeCount:null,replyContent:null,repliedAt:null,createdAt:null,updatedAt:null},g.resetForm("reviewsManageRef")}function h(){d.value.pageNum=1,k()}function oe(){g.resetForm("queryRef"),h()}function ie(i){W();const o=i.reviewId||ae.value;Ae(o).then(w=>{s.value=w.data,V.value=!0,J.value="查看详情"})}function de(){b.value.reviewId=s.value.reviewId,b.value.replyContent=s.value.replyContent||"",S.value=!0}function re(){S.value=!1,g.resetForm("replyFormRef")}function ue(i){const o=i.getFullYear(),w=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0"),B=String(i.getHours()).padStart(2,"0"),E=String(i.getMinutes()).padStart(2,"0"),v=String(i.getSeconds()).padStart(2,"0");return`${o}-${w}-${c} ${B}:${E}:${v}`}function ce(){if(!b.value.replyContent){g.$modal.msgError("回复内容不能为空");return}const o=ue(new Date),w={reviewId:b.value.reviewId,replyContent:b.value.replyContent,repliedAt:o};j(w).then(c=>{g.$modal.msgSuccess("回复成功"),S.value=!1,s.value.replyContent=b.value.replyContent,s.value.repliedAt=o,k()}).catch(()=>{g.$modal.msgError("回复失败")})}function pe(){g.$modal.confirm("确认审核通过该评价？").then(()=>{const i={reviewId:s.value.reviewId,status:1};return j(i)}).then(()=>{g.$modal.msgSuccess("审核通过成功"),V.value=!1,k()}).catch(()=>{})}function X(){g.$modal.confirm("确认驳回评价（下架）该评价？").then(()=>{const i={reviewId:s.value.reviewId,status:2};return j(i)}).then(()=>{g.$modal.msgSuccess("审核通过成功"),V.value=!1,k()}).catch(()=>{})}function _e(){g.download("manage/reviewsManage/export",{...d.value},`reviewsManage_${new Date().getTime()}.xlsx`)}const H=y([]);function me(){Me(De).then(i=>{H.value=i.rows})}return k(),me(),(i,o)=>{const w=m("el-input"),c=m("el-form-item"),B=m("el-option"),E=m("el-select"),v=m("el-button"),K=m("el-form"),C=m("el-col"),ve=m("right-toolbar"),T=m("el-row"),R=m("el-rate"),Z=m("dict-tag"),ge=m("pagination"),fe=m("el-image"),Q=m("el-dialog"),ee=te("hasPermi"),he=te("loading");return r(),p("div",$e,[A(a(K,{model:t(d),ref:"queryRef",inline:!0,"label-width":"68px"},{default:n(()=>[a(c,{label:"用户ID",prop:"userId"},{default:n(()=>[a(w,{modelValue:t(d).userId,"onUpdate:modelValue":o[0]||(o[0]=l=>t(d).userId=l),placeholder:"请输入用户ID",clearable:"",onKeyup:z(h,["enter"])},null,8,["modelValue"])]),_:1}),a(c,{label:"产品ID",prop:"productId"},{default:n(()=>[a(w,{modelValue:t(d).productId,"onUpdate:modelValue":o[1]||(o[1]=l=>t(d).productId=l),placeholder:"请输入产品ID",clearable:"",onKeyup:z(h,["enter"])},null,8,["modelValue"])]),_:1}),a(c,{label:"订单ID",prop:"orderId"},{default:n(()=>[a(w,{modelValue:t(d).orderId,"onUpdate:modelValue":o[2]||(o[2]=l=>t(d).orderId=l),placeholder:"请输入订单ID",clearable:"",onKeyup:z(h,["enter"])},null,8,["modelValue"])]),_:1}),a(c,{label:"状态",prop:"status"},{default:n(()=>[a(E,{modelValue:t(d).status,"onUpdate:modelValue":o[3]||(o[3]=l=>t(d).status=l),placeholder:"请选择状态",clearable:""},{default:n(()=>[(r(!0),p($,null,F(t(L),l=>(r(),x(B,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,null,{default:n(()=>[a(v,{type:"primary",icon:"Search",onClick:h},{default:n(()=>[f("搜索")]),_:1}),a(v,{icon:"Refresh",onClick:oe},{default:n(()=>[f("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[le,t(q)]]),a(T,{gutter:10,class:"mb8"},{default:n(()=>[a(C,{span:1.5},{default:n(()=>[A((r(),x(v,{type:"warning",plain:"",icon:"Download",onClick:_e},{default:n(()=>[f("导出")]),_:1})),[[ee,["manage:reviewsManage:export"]]])]),_:1}),a(ve,{showSearch:t(q),"onUpdate:showSearch":o[4]||(o[4]=l=>O(q)?q.value=l:null),onQueryTable:k},null,8,["showSearch"])]),_:1}),A((r(),p("div",Fe,[(r(!0),p($,null,F(t(G),l=>(r(),p("div",{key:l.reviewId,class:"review-card"},[e("div",qe,[e("div",Te,[e("div",Le,"评价编号: "+u(l.reviewId),1),e("div",Pe,[e("span",null,"订单: "+u(l.orderId),1),e("span",null,"用户: "+u(l.userId),1),e("span",null,[f("产品名称: "),(r(!0),p($,null,F(t(H),M=>(r(),p("span",{key:M.productId},[M.productId===l.productId?(r(),p("span",Ne,u(M.title),1)):D("",!0)]))),128))])])]),e("div",He,[A((r(),x(v,{link:"",type:"primary",icon:"Edit",onClick:M=>ie(l)},{default:n(()=>[f("查看评价详细")]),_:2},1032,["onClick"])),[[ee,["manage:reviewsManage:query"]]])])]),e("div",Be,[e("div",Ee,u(l.title),1),e("div",Ke,[e("div",ze,[Oe,a(R,{"model-value":l.overallRating,disabled:"",max:5},null,8,["model-value"]),e("span",je,u(l.overallRating)+"分",1)])]),e("div",Ye,[e("div",Ge,[Je,a(Z,{options:t(L),value:l.status},null,8,["options","value"])]),e("div",We,[Xe,e("span",null,u(l.likeCount),1)]),e("div",Ze,[Qe,e("span",null,u(i.parseTime(l.createdAt,"{y}-{m}-{d}")),1)])])])]))),128))])),[[he,t(P)]]),A(a(ge,{total:t(N),page:t(d).pageNum,"onUpdate:page":o[5]||(o[5]=l=>t(d).pageNum=l),limit:t(d).pageSize,"onUpdate:limit":o[6]||(o[6]=l=>t(d).pageSize=l),onPagination:k},null,8,["total","page","limit"]),[[le,t(N)>0]]),a(Q,{title:t(J),modelValue:t(V),"onUpdate:modelValue":o[14]||(o[14]=l=>O(V)?V.value=l:null),width:"800px","append-to-body":""},{footer:n(()=>[e("div",al,[a(v,{onClick:ne},{default:n(()=>[f("取 消")]),_:1}),a(v,{type:"primary",onClick:de},{default:n(()=>[f("回复顾客")]),_:1}),t(s).status===0||t(s).status===2?(r(),x(v,{key:0,type:"success",onClick:pe},{default:n(()=>[f("审核通过")]),_:1})):D("",!0),t(s).status===0?(r(),x(v,{key:1,type:"warning",onClick:X},{default:n(()=>[f("审核驳回")]),_:1})):D("",!0),t(s).status===1?(r(),x(v,{key:2,type:"success",onClick:X},{default:n(()=>[f("下架评论")]),_:1})):D("",!0)])]),default:n(()=>[a(K,{ref:"reviewsManageRef",model:t(s),"label-width":"100px",class:"view-form enhanced-dialog"},{default:n(()=>[e("div",et,[e("div",tt,[lt,e("div",at,u(t(s).title||"无标题"),1)]),e("div",st,[nt,e("div",{class:"form-text content-view",innerHTML:t(s).content||"无内容"},null,8,ot)]),e("div",it,[dt,e("div",rt,[e("div",ut,[ct,e("div",pt,[a(R,{modelValue:t(s).serviceRating,"onUpdate:modelValue":o[7]||(o[7]=l=>t(s).serviceRating=l),disabled:"",max:5},null,8,["modelValue"]),e("span",_t,u(t(s).serviceRating)+"分",1)])]),e("div",mt,[vt,e("div",gt,[a(R,{modelValue:t(s).itineraryRating,"onUpdate:modelValue":o[8]||(o[8]=l=>t(s).itineraryRating=l),disabled:"",max:5},null,8,["modelValue"]),e("span",ft,u(t(s).itineraryRating)+"分",1)])]),e("div",ht,[yt,e("div",It,[a(R,{modelValue:t(s).accommodationRating,"onUpdate:modelValue":o[9]||(o[9]=l=>t(s).accommodationRating=l),disabled:"",max:5},null,8,["modelValue"]),e("span",wt,u(t(s).accommodationRating)+"分",1)])]),e("div",bt,[Rt,e("div",Vt,[a(R,{modelValue:t(s).foodRating,"onUpdate:modelValue":o[10]||(o[10]=l=>t(s).foodRating=l),disabled:"",max:5},null,8,["modelValue"]),e("span",kt,u(t(s).foodRating)+"分",1)])]),e("div",Ct,[xt,e("div",St,[a(R,{modelValue:t(s).transportationRating,"onUpdate:modelValue":o[11]||(o[11]=l=>t(s).transportationRating=l),disabled:"",max:5},null,8,["modelValue"]),e("span",Mt,u(t(s).transportationRating)+"分",1)])]),e("div",Dt,[Ut,e("div",At,[a(R,{modelValue:t(s).guideRating,"onUpdate:modelValue":o[12]||(o[12]=l=>t(s).guideRating=l),disabled:"",max:5},null,8,["modelValue"]),e("span",$t,u(t(s).guideRating)+"分",1)])]),e("div",Ft,[qt,e("div",Tt,[a(R,{modelValue:t(s).valueForMoneyRating,"onUpdate:modelValue":o[13]||(o[13]=l=>t(s).valueForMoneyRating=l),disabled:"",max:5},null,8,["modelValue"]),e("span",Lt,u(t(s).valueForMoneyRating)+"分",1)])])])]),e("div",Pt,[Nt,t(s).imageUrls?(r(),p("div",Ht,[(r(!0),p($,null,F(t(s).imageUrls.split(","),(l,M)=>(r(),x(fe,{key:M,src:l,class:"preview-image","preview-src-list":t(s).imageUrls.split(","),fit:"cover","preview-teleported":!0},null,8,["src","preview-src-list"]))),128))])):(r(),p("div",Bt,"暂无图片"))])]),e("div",Et,[Kt,a(T,null,{default:n(()=>[a(C,{span:12},{default:n(()=>[a(c,{label:"评价ID:"},{default:n(()=>[e("span",zt,u(t(s).reviewId),1)]),_:1})]),_:1}),a(C,{span:12},{default:n(()=>[a(c,{label:"用户ID:"},{default:n(()=>[e("span",Ot,u(t(s).userId),1)]),_:1})]),_:1})]),_:1}),a(T,null,{default:n(()=>[a(C,{span:12},{default:n(()=>[a(c,{label:"产品名称:"},{default:n(()=>[e("span",jt,[(r(!0),p($,null,F(t(H),l=>(r(),p("span",{key:l.productId},[l.productId===t(s).productId?(r(),p("span",Yt,u(l.title),1)):D("",!0)]))),128))])]),_:1})]),_:1}),a(C,{span:12},{default:n(()=>[a(c,{label:"订单ID:"},{default:n(()=>[e("span",Gt,u(t(s).orderId),1)]),_:1})]),_:1})]),_:1}),a(T,null,{default:n(()=>[a(C,{span:12},{default:n(()=>[a(c,{label:"有用数:"},{default:n(()=>[e("span",Jt,u(t(s).likeCount),1)]),_:1})]),_:1}),a(C,{span:12},{default:n(()=>[a(c,{label:"是否匿名:"},{default:n(()=>[e("span",Wt,u(t(s).isAnonymous?"是":"否"),1)]),_:1})]),_:1})]),_:1}),a(c,{label:"状态:"},{default:n(()=>[a(Z,{options:t(L),value:t(s).status},null,8,["options","value"])]),_:1}),a(c,{label:"创建时间:"},{default:n(()=>[e("span",Xt,u(i.parseTime(t(s).createdAt)),1)]),_:1})]),e("div",Zt,[Qt,a(c,{"label-width":"0"},{default:n(()=>[t(s).replyContent?(r(),p("div",{key:0,class:"reply-content",innerHTML:t(s).replyContent},null,8,el)):(r(),p("div",tl,"暂无回复")),t(s).repliedAt?(r(),p("div",ll,"回复时间: "+u(i.parseTime(t(s).repliedAt)),1)):D("",!0)]),_:1})])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),a(Q,{title:"商家回复",modelValue:t(S),"onUpdate:modelValue":o[16]||(o[16]=l=>O(S)?S.value=l:null),width:"500px","append-to-body":""},{footer:n(()=>[e("div",sl,[a(v,{onClick:re},{default:n(()=>[f("取 消")]),_:1}),a(v,{type:"primary",onClick:ce},{default:n(()=>[f("回 复")]),_:1})])]),default:n(()=>[a(K,{ref:"replyFormRef",model:t(b),"label-width":"80px"},{default:n(()=>[a(c,{label:"回复内容",prop:"replyContent"},{default:n(()=>[a(w,{modelValue:t(b).replyContent,"onUpdate:modelValue":o[15]||(o[15]=l=>t(b).replyContent=l),type:"textarea",rows:4,placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),cl=ye(ol,[["__scopeId","data-v-73b4743e"]]);export{cl as default};
