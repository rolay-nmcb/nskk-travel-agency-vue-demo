import{_ as Ne,C as Ce,d as Ue,r as v,O as De,T as Te,y as Pe,e as s,R as J,c as V,o as p,H as N,h as l,S as W,i as a,l as X,B as o,F as P,D as M,j as b,m as n,f as h,A as _}from"./index-CqU5sET7.js";import{l as Me,u as Se,a as Be}from"./userManage-B6SVjGn0.js";import{g as $e}from"./profilesManage-wgDOMe7j.js";import{l as Ae}from"./couponsUserManage-CmrF8zlg.js";import{l as Z}from"./page-DmiFfIKn.js";const qe={class:"app-container"},Ee={class:"dialog-footer"},Re={key:1,class:"profile-details"},Fe={class:"remark-content"},Le={class:"dialog-footer"},Oe={key:0},Ye={key:1},ze={class:"dialog-footer"},Ke=Ce({name:"UserManage"}),Qe=Object.assign(Ke,{setup(je){const{proxy:y}=Ue(),{user_status:S,sys_user_sex:B}=y.useDict("user_status","sys_user_sex"),F=v([]),I=v(!1),x=v(!1),$=v(!0),A=v(!0),ee=v([]),le=v(!0),ae=v(!0),q=v(0),C=v(""),U=v(!1),te=De({form:{},viewForm:{},queryParams:{pageNum:1,pageSize:10,userId:null,userName:null,sex:null,status:null},rules:{userName:[{required:!0,message:"用户账号不能为空",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]}}),{queryParams:i,form:u,rules:oe,viewForm:r}=Te(te);function k(){$.value=!0,Me(i.value).then(d=>{F.value=d.rows,q.value=d.total,$.value=!1})}function D(){I.value=!1,x.value=!1,ue()}function ue(){u.value={userId:null,deptId:null,userName:null,nickName:null,userType:null,email:null,phonenumber:null,sex:null,avatar:null,password:null,status:null,delFlag:null,loginIp:null,loginDate:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},r.value={createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null,profileId:null,userId:null,realName:null,birthdate:null,passportNumber:null,passportExpiry:null,emergencyContact:null,emergencyPhone:null,createdAt:null,updatedAt:null},y.resetForm("userManageRef")}function T(){i.value.pageNum=1,k()}function ne(){y.resetForm("queryRef"),T()}function re(d){ee.value=d.map(t=>t.userId),le.value=d.length!=1,ae.value=!d.length}function se(){y.$refs.userManageRef.validate(d=>{d&&(u.value.userId!=null?Se(u.value).then(t=>{y.$modal.msgSuccess("修改成功"),I.value=!1,k()}):Be(u.value).then(t=>{y.$modal.msgSuccess("新增成功"),I.value=!1,k()}))})}const de=Pe(()=>r.value&&(r.value.realName||r.value.birthdate||r.value.passportNumber||r.value.passportExpiry||r.value.emergencyContact||r.value.emergencyPhone||r.value.remark));function pe(d){const t=d.userId;$e(t).then(c=>{c.data?r.value=c.data:r.value={createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null,profileId:null,userId:t,realName:null,birthdate:null,passportNumber:null,passportExpiry:null,emergencyContact:null,emergencyPhone:null,createdAt:null,updatedAt:null},x.value=!0,C.value="查看用户信息"}).catch(c=>{r.value={createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null,profileId:null,userId:t,realName:null,birthdate:null,passportNumber:null,passportExpiry:null,emergencyContact:null,emergencyPhone:null,createdAt:null,updatedAt:null},x.value=!0,C.value="查看用户信息",y.$modal.msgError("获取用户详细信息失败")})}function ie(d){D(),y.$router.push({path:"/feedback/reviewsManage",query:{userId:d}})}function me(d){D(),y.$router.push({path:"/feedback/travelNotesManage",query:{userId:d}})}function fe(d){_e(d).then(()=>{U.value=!0})}const L=v([]);function _e(d){return Z.userId=d,Ae(Z).then(t=>{L.value=t.rows})}function ce(){y.download("system/user/export",{...i.value},`userManage_${new Date().getTime()}.xlsx`)}return k(),(d,t)=>{const c=s("el-input"),m=s("el-form-item"),O=s("el-option"),Y=s("el-select"),g=s("el-button"),z=s("el-form"),ve=s("el-col"),ge=s("right-toolbar"),be=s("el-row"),f=s("el-table-column"),K=s("dict-tag"),ye=s("image-preview"),Q=s("el-table"),we=s("pagination"),j=s("el-radio"),H=s("el-radio-group"),Ve=s("image-upload"),ke=s("el-date-picker"),E=s("el-dialog"),he=s("el-empty"),w=s("el-descriptions-item"),Ie=s("el-descriptions"),R=s("el-tag"),G=J("hasPermi"),xe=J("loading");return p(),V("div",qe,[N(l(z,{model:o(i),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[l(m,{label:"用户ID",prop:"userId"},{default:a(()=>[l(c,{modelValue:o(i).userId,"onUpdate:modelValue":t[0]||(t[0]=e=>o(i).userId=e),placeholder:"请输入用户ID",clearable:"",onKeyup:X(T,["enter"])},null,8,["modelValue"])]),_:1}),l(m,{label:"用户账号",prop:"userName"},{default:a(()=>[l(c,{modelValue:o(i).userName,"onUpdate:modelValue":t[1]||(t[1]=e=>o(i).userName=e),placeholder:"请输入用户账号",clearable:"",onKeyup:X(T,["enter"])},null,8,["modelValue"])]),_:1}),l(m,{label:"用户性别",prop:"sex"},{default:a(()=>[l(Y,{modelValue:o(i).sex,"onUpdate:modelValue":t[2]||(t[2]=e=>o(i).sex=e),placeholder:"请选择用户性别",clearable:""},{default:a(()=>[(p(!0),V(P,null,M(o(B),e=>(p(),b(O,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"帐号状态",prop:"status"},{default:a(()=>[l(Y,{modelValue:o(i).status,"onUpdate:modelValue":t[3]||(t[3]=e=>o(i).status=e),placeholder:"请选择帐号状态",clearable:""},{default:a(()=>[(p(!0),V(P,null,M(o(S),e=>(p(),b(O,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:a(()=>[l(g,{type:"primary",icon:"Search",onClick:T},{default:a(()=>[n("搜索")]),_:1}),l(g,{icon:"Refresh",onClick:ne},{default:a(()=>[n("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[W,A.value]]),l(be,{gutter:10,class:"mb8"},{default:a(()=>[l(ve,{span:1.5},{default:a(()=>[N((p(),b(g,{type:"warning",plain:"",icon:"Download",onClick:ce},{default:a(()=>[n("导出")]),_:1})),[[G,["system:user:export"]]])]),_:1}),l(ge,{showSearch:A.value,"onUpdate:showSearch":t[4]||(t[4]=e=>A.value=e),onQueryTable:k},null,8,["showSearch"])]),_:1}),N((p(),b(Q,{data:F.value,onSelectionChange:re},{default:a(()=>[l(f,{type:"selection",width:"55",align:"center"}),l(f,{label:"用户ID",align:"center",prop:"userId"}),l(f,{label:"用户账号",align:"center",prop:"userName"}),l(f,{label:"用户昵称",align:"center",prop:"nickName"}),l(f,{label:"用户性别",align:"center",prop:"sex"},{default:a(e=>[l(K,{options:o(B),value:e.row.sex},null,8,["options","value"])]),_:1}),l(f,{label:"头像",align:"center",prop:"avatar",width:"100"},{default:a(e=>[l(ye,{src:e.row.avatar,width:50,height:50},null,8,["src"])]),_:1}),l(f,{label:"帐号状态",align:"center",prop:"status"},{default:a(e=>[l(K,{options:o(S),value:e.row.status},null,8,["options","value"])]),_:1}),l(f,{label:"最后登录IP",align:"center",prop:"loginIp"}),l(f,{label:"最后登录时间",align:"center",prop:"loginDate",width:"180"},{default:a(e=>[h("span",null,_(d.parseTime(e.row.loginDate,"{y}-{m}-{d}")),1)]),_:1}),l(f,{label:"备注",align:"center",prop:"remark"},{default:a(e=>[h("span",null,_(e.row.remark?e.row.remark:"用户"),1)]),_:1}),l(f,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(e=>[N((p(),b(g,{link:"",type:"primary",icon:"Edit",onClick:He=>pe(e.row)},{default:a(()=>[n("查看用户信息")]),_:2},1032,["onClick"])),[[G,["system:user:query"]]])]),_:1})]),_:1},8,["data"])),[[xe,$.value]]),N(l(we,{total:q.value,page:o(i).pageNum,"onUpdate:page":t[5]||(t[5]=e=>o(i).pageNum=e),limit:o(i).pageSize,"onUpdate:limit":t[6]||(t[6]=e=>o(i).pageSize=e),onPagination:k},null,8,["total","page","limit"]),[[W,q.value>0]]),l(E,{title:C.value,modelValue:I.value,"onUpdate:modelValue":t[18]||(t[18]=e=>I.value=e),width:"500px","append-to-body":""},{footer:a(()=>[h("div",Ee,[l(g,{type:"primary",onClick:se},{default:a(()=>[n("确 定")]),_:1}),l(g,{onClick:D},{default:a(()=>[n("取 消")]),_:1})])]),default:a(()=>[l(z,{ref:"userManageRef",model:o(u),rules:o(oe),"label-width":"80px"},{default:a(()=>[l(m,{label:"用户账号",prop:"userName"},{default:a(()=>[l(c,{modelValue:o(u).userName,"onUpdate:modelValue":t[7]||(t[7]=e=>o(u).userName=e),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),l(m,{label:"用户密码",prop:"password"},{default:a(()=>[l(c,{modelValue:o(u).password,"onUpdate:modelValue":t[8]||(t[8]=e=>o(u).password=e),placeholder:"请输入用户密码"},null,8,["modelValue"])]),_:1}),l(m,{label:"用户昵称",prop:"nickName"},{default:a(()=>[l(c,{modelValue:o(u).nickName,"onUpdate:modelValue":t[9]||(t[9]=e=>o(u).nickName=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),l(m,{label:"用户邮箱",prop:"email"},{default:a(()=>[l(c,{modelValue:o(u).email,"onUpdate:modelValue":t[10]||(t[10]=e=>o(u).email=e),placeholder:"请输入用户邮箱"},null,8,["modelValue"])]),_:1}),l(m,{label:"手机号码",prop:"phonenumber"},{default:a(()=>[l(c,{modelValue:o(u).phonenumber,"onUpdate:modelValue":t[11]||(t[11]=e=>o(u).phonenumber=e),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),l(m,{label:"用户性别",prop:"sex"},{default:a(()=>[l(H,{modelValue:o(u).sex,"onUpdate:modelValue":t[12]||(t[12]=e=>o(u).sex=e)},{default:a(()=>[(p(!0),V(P,null,M(o(B),e=>(p(),b(j,{key:e.value,label:e.value},{default:a(()=>[n(_(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"头像地址",prop:"avatar"},{default:a(()=>[l(Ve,{modelValue:o(u).avatar,"onUpdate:modelValue":t[13]||(t[13]=e=>o(u).avatar=e)},null,8,["modelValue"])]),_:1}),l(m,{label:"帐号状态",prop:"status"},{default:a(()=>[l(H,{modelValue:o(u).status,"onUpdate:modelValue":t[14]||(t[14]=e=>o(u).status=e)},{default:a(()=>[(p(!0),V(P,null,M(o(S),e=>(p(),b(j,{key:e.value,label:e.value},{default:a(()=>[n(_(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"最后登录IP",prop:"loginIp"},{default:a(()=>[l(c,{modelValue:o(u).loginIp,"onUpdate:modelValue":t[15]||(t[15]=e=>o(u).loginIp=e),placeholder:"请输入最后登录IP"},null,8,["modelValue"])]),_:1}),l(m,{label:"最后登录时间",prop:"loginDate"},{default:a(()=>[l(ke,{clearable:"",modelValue:o(u).loginDate,"onUpdate:modelValue":t[16]||(t[16]=e=>o(u).loginDate=e),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择最后登录时间"},null,8,["modelValue"])]),_:1}),l(m,{label:"备注",prop:"remark"},{default:a(()=>[l(c,{modelValue:o(u).remark,"onUpdate:modelValue":t[17]||(t[17]=e=>o(u).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(E,{title:C.value,modelValue:x.value,"onUpdate:modelValue":t[22]||(t[22]=e=>x.value=e),width:"500px","append-to-body":""},{footer:a(()=>[h("div",Le,[l(g,{onClick:t[19]||(t[19]=e=>ie(o(r).userId))},{default:a(()=>[n("查看评价")]),_:1}),l(g,{onClick:t[20]||(t[20]=e=>me(o(r).userId))},{default:a(()=>[n("查看游记")]),_:1}),l(g,{onClick:t[21]||(t[21]=e=>fe(o(r).userId))},{default:a(()=>[n("查看优惠券")]),_:1}),l(g,{type:"primary",onClick:D},{default:a(()=>[n("关闭")]),_:1})])]),default:a(()=>[de.value?(p(),V("div",Re,[l(Ie,{column:1,border:""},{default:a(()=>[l(w,{label:"真实姓名"},{default:a(()=>[n(_(o(r).realName||"-"),1)]),_:1}),l(w,{label:"出生日期"},{default:a(()=>[n(_(o(r).birthdate||"-"),1)]),_:1}),l(w,{label:"护照号码"},{default:a(()=>[n(_(o(r).passportNumber||"-"),1)]),_:1}),l(w,{label:"护照有效期"},{default:a(()=>[n(_(o(r).passportExpiry||"-"),1)]),_:1}),l(w,{label:"紧急联系人"},{default:a(()=>[n(_(o(r).emergencyContact||"-"),1)]),_:1}),l(w,{label:"紧急联系电话"},{default:a(()=>[n(_(o(r).emergencyPhone||"-"),1)]),_:1}),l(w,{label:"创建时间"},{default:a(()=>[n(_(o(r).createdAt||"-"),1)]),_:1}),l(w,{label:"更新时间"},{default:a(()=>[n(_(o(r).updatedAt||"-"),1)]),_:1}),l(w,{label:"备注"},{default:a(()=>[h("div",Fe,_(o(r).remark||"无"),1)]),_:1})]),_:1})])):(p(),b(he,{key:0,description:"该用户暂无个人信息"}))]),_:1},8,["title","modelValue"]),l(E,{title:"用户优惠券",modelValue:U.value,"onUpdate:modelValue":t[24]||(t[24]=e=>U.value=e),width:"800px","append-to-body":""},{footer:a(()=>[h("div",ze,[l(g,{onClick:t[23]||(t[23]=e=>U.value=!1)},{default:a(()=>[n("取消")]),_:1})])]),default:a(()=>[l(Q,{data:L.value,style:{width:"100%"}},{default:a(()=>[l(f,{prop:"code",label:"优惠券码",width:"150"}),l(f,{prop:"status",label:"状态",width:"100"},{default:a(e=>[e.row.status===0?(p(),b(R,{key:0,type:"success"},{default:a(()=>[n("未使用")]),_:1})):e.row.status===1?(p(),b(R,{key:1,type:"warning"},{default:a(()=>[n("已使用")]),_:1})):(p(),b(R,{key:2,type:"info"},{default:a(()=>[n("已过期")]),_:1}))]),_:1}),l(f,{prop:"acquiredAt",label:"获取时间",width:"120"}),l(f,{prop:"expirationTime",label:"过期时间",width:"180"},{default:a(e=>[n(_(d.parseTime(e.row.expirationTime,"{y}-{m}-{d}")),1)]),_:1}),l(f,{label:"订单编号",width:"120","show-overflow-tooltip":""},{default:a(e=>[e.row.status===1&&e.row.orderId?(p(),V("span",Oe,_(e.row.orderId),1)):(p(),V("span",Ye,"无使用订单"))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}}),el=Ne(Qe,[["__scopeId","data-v-00ff937f"]]);export{el as default};
