import{C as pe,d as me,r as _,O as ce,T as fe,e as i,R as O,c as T,o as p,H as y,h as e,k as _e,S as ve,B as t,i as a,l as ge,F as j,D as K,j as g,m as u,P as H,f as z,A as be,Q as ye}from"./index-Lq3EucIc.js";import{l as G,g as he,d as Ie,u as Ve,a as ke}from"./destinations-B0gvWy6N.js";const we={class:"app-container"},Ce={class:"dialog-footer"},De=pe({name:"Destinations"}),Se=Object.assign(De,{setup(Pe){const{proxy:r}=me(),{destination_type:w}=r.useDict("destination_type"),A=_([]),C=_([]),c=_(!1),D=_(!0),h=_(!0),P=_(""),x=_(!0),U=_(!0),J=ce({form:{},queryParams:{parentId:null,name:null,type:null,isPopular:null},rules:{name:[{required:!0,message:"目的地名称不能为空",trigger:"blur"}],type:[{required:!0,message:"类型(0:大洲,1:国家,2:省州,3:城市,4:景点)不能为空",trigger:"change"}]}}),{queryParams:f,form:o,rules:M}=fe(J);function b(){D.value=!0,G(f.value).then(d=>{A.value=r.handleTree(d.data,"destinationId","parentId"),D.value=!1})}function $(){G().then(d=>{C.value=[];const n={destinationId:0,name:"顶级节点",children:[]};n.children=r.handleTree(d.data,"destinationId","parentId"),C.value.push(n)})}function W(){c.value=!1,S()}function S(){o.value={destinationId:null,parentId:null,name:null,type:null,tag:null,description:null,coverImage:null,isPopular:null,createdAt:null,updatedAt:null},r.resetForm("destinationsRef")}function R(){b()}function X(){r.resetForm("queryRef"),R()}function q(d){S(),$(),d!=null&&d.destinationId?o.value.parentId=d.destinationId:o.value.parentId=0,c.value=!0,P.value="添加目的地管理"}function Y(){U.value=!1,x.value=!x.value,ye(()=>{U.value=!0})}async function Z(d){S(),await $(),d!=null&&(o.value.parentId=d.parentId),he(d.destinationId).then(n=>{o.value=n.data,c.value=!0,P.value="修改目的地管理"})}function ee(){r.$refs.destinationsRef.validate(d=>{d&&(o.value.destinationId!=null?Ve(o.value).then(n=>{r.$modal.msgSuccess("修改成功"),c.value=!1,b()}):ke(o.value).then(n=>{r.$modal.msgSuccess("新增成功"),c.value=!1,b()}))})}function le(d){r.$modal.confirm('是否确认删除目的地管理编号为"'+d.destinationId+'"的数据项？').then(function(){return Ie(d.destinationId)}).then(()=>{b(),r.$modal.msgSuccess("删除成功")}).catch(()=>{})}return b(),(d,n)=>{const I=i("el-input"),s=i("el-form-item"),B=i("el-option"),F=i("el-select"),V=i("el-radio"),E=i("el-radio-group"),m=i("el-button"),N=i("el-form"),Q=i("el-col"),ae=i("right-toolbar"),te=i("el-row"),v=i("el-table-column"),ne=i("dict-tag"),oe=i("image-preview"),de=i("el-table"),ie=i("el-tree-select"),ue=i("image-upload"),se=i("el-dialog"),k=O("hasPermi"),re=O("loading");return p(),T("div",we,[y(e(N,{model:t(f),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[e(s,{label:"目的地",prop:"name"},{default:a(()=>[e(I,{modelValue:t(f).name,"onUpdate:modelValue":n[0]||(n[0]=l=>t(f).name=l),placeholder:"请输入目的地",clearable:"",onKeyup:ge(R,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"类型",prop:"type"},{default:a(()=>[e(F,{modelValue:t(f).type,"onUpdate:modelValue":n[1]||(n[1]=l=>t(f).type=l),placeholder:"请选择类型",clearable:""},{default:a(()=>[(p(!0),T(j,null,K(t(w),l=>(p(),g(B,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"是否热门",prop:"isPopular"},{default:a(()=>[e(E,{modelValue:t(f).isPopular,"onUpdate:modelValue":n[2]||(n[2]=l=>t(f).isPopular=l)},{default:a(()=>[e(V,{label:1},{default:a(()=>[u("是")]),_:1}),e(V,{label:0},{default:a(()=>[u("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:a(()=>[e(m,{type:"primary",icon:"Search",onClick:R},{default:a(()=>[u("搜索")]),_:1}),e(m,{icon:"Refresh",onClick:X},{default:a(()=>[u("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[ve,t(h)]]),e(te,{gutter:10,class:"mb8"},{default:a(()=>[e(Q,{span:1.5},{default:a(()=>[y((p(),g(m,{type:"primary",plain:"",icon:"Plus",onClick:q},{default:a(()=>[u("新增")]),_:1})),[[k,["manage:destinations:add"]]])]),_:1}),e(Q,{span:1.5},{default:a(()=>[e(m,{type:"info",plain:"",icon:"Sort",onClick:Y},{default:a(()=>[u("展开/折叠")]),_:1})]),_:1}),e(ae,{showSearch:t(h),"onUpdate:showSearch":n[3]||(n[3]=l=>H(h)?h.value=l:null),onQueryTable:b},null,8,["showSearch"])]),_:1}),t(U)?y((p(),g(de,{key:0,data:t(A),"row-key":"destinationId","default-expand-all":t(x),"tree-props":{children:"children",hasChildren:"hasChildren"}},{default:a(()=>[e(v,{label:"目的地名称",align:"center",prop:"name"}),e(v,{label:"目的地ID",align:"center",prop:"destinationId",width:"100"}),e(v,{label:"类型",align:"center",prop:"type"},{default:a(l=>[e(ne,{options:t(w),value:l.row.type},null,8,["options","value"])]),_:1}),e(v,{label:"标签",align:"center",prop:"tag"}),e(v,{label:"封面图",align:"center",prop:"coverImage",width:"100"},{default:a(l=>[e(oe,{src:l.row.coverImage,width:50,height:50},null,8,["src"])]),_:1}),e(v,{label:"创建时间",align:"center",prop:"createdAt",width:"180"},{default:a(l=>[z("span",null,be(d.parseTime(l.row.createdAt,"{y}-{m}-{d} {h}:{m}:{s}")),1)]),_:1}),e(v,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(l=>[y((p(),g(m,{link:"",type:"primary",icon:"Edit",onClick:L=>Z(l.row)},{default:a(()=>[u("修改")]),_:2},1032,["onClick"])),[[k,["manage:destinations:edit"]]]),y((p(),g(m,{link:"",type:"primary",icon:"Plus",onClick:L=>q(l.row)},{default:a(()=>[u("新增")]),_:2},1032,["onClick"])),[[k,["manage:destinations:add"]]]),y((p(),g(m,{link:"",type:"primary",icon:"Delete",onClick:L=>le(l.row)},{default:a(()=>[u("删除")]),_:2},1032,["onClick"])),[[k,["manage:destinations:remove"]]])]),_:1})]),_:1},8,["data","default-expand-all"])),[[re,t(D)]]):_e("",!0),e(se,{title:t(P),modelValue:t(c),"onUpdate:modelValue":n[11]||(n[11]=l=>H(c)?c.value=l:null),width:"500px","append-to-body":""},{footer:a(()=>[z("div",Ce,[e(m,{type:"primary",onClick:ee},{default:a(()=>[u("确 定")]),_:1}),e(m,{onClick:W},{default:a(()=>[u("取 消")]),_:1})])]),default:a(()=>[e(N,{ref:"destinationsRef",model:t(o),rules:t(M),"label-width":"80px"},{default:a(()=>[e(s,{label:"父级目的地ID",prop:"parentId"},{default:a(()=>[e(ie,{modelValue:t(o).parentId,"onUpdate:modelValue":n[4]||(n[4]=l=>t(o).parentId=l),data:t(C),props:{value:"destinationId",label:"name",children:"children"},"value-key":"destinationId",placeholder:"请选择父级目的地ID","check-strictly":"",disabled:t(o).destinationId!=null},null,8,["modelValue","data","disabled"])]),_:1}),e(s,{label:"名称",prop:"name"},{default:a(()=>[e(I,{modelValue:t(o).name,"onUpdate:modelValue":n[5]||(n[5]=l=>t(o).name=l),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"类型",prop:"type"},{default:a(()=>[e(F,{modelValue:t(o).type,"onUpdate:modelValue":n[6]||(n[6]=l=>t(o).type=l),placeholder:"请选择类型"},{default:a(()=>[(p(!0),T(j,null,K(t(w),l=>(p(),g(B,{key:l.value,label:l.label,value:parseInt(l.value)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"标签",prop:"tag"},{default:a(()=>[e(I,{modelValue:t(o).tag,"onUpdate:modelValue":n[7]||(n[7]=l=>t(o).tag=l),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),e(s,{label:"描述",prop:"description"},{default:a(()=>[e(I,{modelValue:t(o).description,"onUpdate:modelValue":n[8]||(n[8]=l=>t(o).description=l),type:"textarea",rows:4,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),e(s,{label:"封面图",prop:"coverImage"},{default:a(()=>[e(ue,{modelValue:t(o).coverImage,"onUpdate:modelValue":n[9]||(n[9]=l=>t(o).coverImage=l)},null,8,["modelValue"])]),_:1}),e(s,{label:"是否热门",prop:"isPopular"},{default:a(()=>[e(E,{modelValue:t(o).isPopular,"onUpdate:modelValue":n[10]||(n[10]=l=>t(o).isPopular=l)},{default:a(()=>[e(V,{label:1},{default:a(()=>[u("是")]),_:1}),e(V,{label:0},{default:a(()=>[u("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Se as default};
