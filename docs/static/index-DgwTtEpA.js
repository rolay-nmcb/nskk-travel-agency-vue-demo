import{$ as Z,_ as Le,C as Ue,b as De,d as xe,r as m,O as Ne,T as Pe,y as $e,v as ze,e as u,R as Te,c as i,o,f as e,h as s,i as c,l as Ae,B as _,m as y,H as X,k as v,F as b,D as I,c8 as Fe,A as n,c9 as qe,ca as Y,cb as Be,S as Oe,j as E,s as je,t as Ee}from"./index-CqU5sET7.js";import{b as Ke,l as Me}from"./reviewsUser-Db4yIioF.js";import{l as Qe}from"./productCategories-_SJyE3Tf.js";import{l as He}from"./destinations-CNa6kP2I.js";function We(k){return Z({url:"/user/userProducts/list",method:"get",params:k})}function Ge(k){return Z({url:"/user/userProducts/"+k,method:"get"})}const r=k=>(je("data-v-8fcc8fd5"),k=k(),Ee(),k),Je={class:"travel-products-page"},Xe=r(()=>e("div",{class:"page-banner"},[e("div",{class:"banner-content"},[e("h1",null,"发现您的完美旅程"),e("p",null,"精选目的地 · 优质服务 · 无忧出行")])],-1)),Ye={class:"filter-section"},Ze={class:"products-section"},et={class:"section-header"},tt=r(()=>e("h2",null,"推荐产品",-1)),st={class:"sort-controls"},lt=r(()=>e("span",null,"排序方式：",-1)),at={class:"products-grid"},ot={class:"product-image"},nt={class:"image-placeholder"},it=r(()=>e("span",null,"暂无图片",-1)),ct={key:0,class:"product-tag"},dt=r(()=>e("span",null,"可预订",-1)),ut=[dt],rt={class:"product-info"},_t={class:"product-title"},vt={class:"travel-days"},pt={class:"product-subtitle"},mt={class:"product-meta"},ht={class:"meta-item"},gt={class:"meta-item"},ft={key:0},yt={class:"product-actions"},kt={key:0,class:"empty-state"},bt={key:0,class:"detail-container"},It={class:"detail-header"},wt=r(()=>e("div",{class:"detail-image-placeholder"},"暂无封面图",-1)),Ct={class:"detail-content"},Vt={class:"images-section"},Rt={key:1,class:"no-images"},St={class:"intro-section"},Lt=r(()=>e("h3",{class:"section-title"},"基本信息",-1)),Ut={class:"basic-info"},Dt={class:"info-row"},xt={class:"info-item"},Nt=r(()=>e("span",{class:"info-label"},"产品ID：",-1)),Pt={class:"info-item"},$t=r(()=>e("span",{class:"info-label"},"分类：",-1)),zt={key:0},Tt={class:"info-item"},At=r(()=>e("span",{class:"info-label"},"目的地：",-1)),Ft={key:0},qt={class:"info-row"},Bt={class:"info-item"},Ot=r(()=>e("span",{class:"info-label"},"行程天数：",-1)),jt={class:"info-item"},Et=r(()=>e("span",{class:"info-label"},"成团人数：",-1)),Kt={class:"info-item"},Mt=r(()=>e("span",{class:"info-label"},"状态：",-1)),Qt=r(()=>e("h3",{class:"section-title"},"产品概述",-1)),Ht={class:"overview-content"},Wt=r(()=>e("h3",{class:"section-title"},"行程安排",-1)),Gt={class:"itinerary-content"},Jt=r(()=>e("h3",{class:"section-title"},"费用说明",-1)),Xt={class:"cost-section"},Yt={class:"cost-item"},Zt=r(()=>e("h4",null,"费用包含",-1)),es={class:"cost-item"},ts=r(()=>e("h4",null,"费用不含",-1)),ss=r(()=>e("h3",{class:"section-title"},"预订须知",-1)),ls={class:"notes-content"},as={class:"reviews-section"},os={class:"reviews-header"},ns=r(()=>e("h3",null,"用户真实评价",-1)),is={key:0,class:"reviews-loading"},cs={key:0},ds={key:0,class:"reviews-stats"},us={class:"overall-rating"},rs={class:"rating-value"},_s={class:"stars"},vs={class:"rating-count"},ps={class:"rating-details"},ms={class:"rating-label"},hs={class:"rating-score"},gs={class:"reviews-list"},fs={class:"review-header"},ys={class:"review-user"},ks={class:"user-name"},bs={class:"review-date"},Is={class:"review-rating"},ws={class:"review-title"},Cs={class:"review-content"},Vs={key:0,class:"review-images"},Rs={key:1,class:"review-like"},Ss={key:0},Ls={key:2,class:"review-reply"},Us=r(()=>e("div",{class:"reply-label"},"商家回复：",-1)),Ds={class:"reply-content"},xs={class:"reply-time"},Ns={key:0,class:"no-reviews"},Ps={class:"dialog-footer"},$s=Ue({name:"UserProducts"}),zs=Object.assign($s,{setup(k){const z=De().id,K="/src/assets/images/introduction/1.jpg",ee=[{key:"overallRating",label:"综合评分"},{key:"serviceRating",label:"服务评分"},{key:"itineraryRating",label:"行程评分"},{key:"accommodationRating",label:"住宿评分"},{key:"foodRating",label:"餐饮评分"},{key:"transportationRating",label:"交通评分"},{key:"guideRating",label:"导游评分"},{key:"valueForMoneyRating",label:"性价比评分"}],{proxy:w}=xe(),{product_status:te}=w.useDict("product_status"),R=m([]),h=m([]),d=m(null),C=m(0),S=m(!0),L=m(!1),N=m(!1),M=m(""),P=m("introduction"),T=m("default"),se=Ne({queryParams:{pageNum:1,pageSize:12,title:null,categoryId:null,destinationId:null,durationDays:null,status:null}}),{queryParams:g}=Pe(se),A=m(0);function F(){S.value=!0,We(g.value).then(a=>{R.value=a.rows,A.value=a.total,S.value=!1}).catch(()=>{S.value=!1})}function q(){g.value.pageNum=1,F()}function le(){w.resetForm("queryRef"),g.value={pageNum:1,pageSize:12,title:null,categoryId:null,destinationId:null,durationDays:null,status:null},q()}const B=$e(()=>d.value&&d.value.images?d.value.images.split(",").filter(a=>a.trim()!==""):[]);function ae(){T.value==="days"?R.value.sort((a,l)=>a.durationDays-l.durationDays):R.value.sort((a,l)=>l.productId-a.productId)}function oe(a){Ge(a.productId).then(l=>{d.value=l.data,M.value=l.data.title,N.value=!0,P.value="introduction",ne(a.productId)})}function ne(a){L.value=!0,Me({pageNum:1,pageSize:1e4,productId:a,searchUserId:z,status:1}).then(l=>{h.value=l.rows||[],ie(),L.value=!1}).catch(()=>{L.value=!1})}function ie(){if(h.value.length===0){C.value=0;return}const a=h.value.reduce((l,f)=>l+(f.overallRating||0),0);C.value=a/h.value.length,console.log(C.value)}function Q(a){return h.value.length===0?0:h.value.reduce((f,U)=>f+(U[a]||0),0)/h.value.length*20}function ce(a){var l;if(((l=d.value)==null?void 0:l.status)!==1){w.$modal.msgWarning("该产品目前不可预订");return}w.$router.push({path:"/purchase",query:{userId:z,productId:a}})}function de(){d.value=null,h.value=[],N.value=!1}function ue(a){const l={reviewId:a.reviewId,userId:z,isLiked:a.isLiked?0:1,likeCount:a.likeCount};Ke(l).then(f=>{f.code===200?(a.isLiked=a.isLiked?0:1,a.isLiked?a.likeCount++:a.likeCount--,w.$modal.msgSuccess(a.isLiked?"点赞成功":"取消点赞成功")):w.$modal.msgError("操作失败")}).catch(f=>{console.error("点赞操作出错:",f),w.$modal.msgError("操作失败")})}const H=m([]),O=m([]);function re(){Qe({pageNum:1,pageSize:1e4}).then(a=>{H.value=a.rows})}function _e(){He({pageNum:1,pageSize:1e4}).then(a=>{O.value=a.data})}return ze(()=>{F(),re(),_e()}),(a,l)=>{const f=u("el-input"),U=u("el-form-item"),D=u("el-option"),ve=u("el-select"),V=u("el-button"),pe=u("el-form"),W=u("el-radio-button"),me=u("el-radio-group"),x=u("el-icon"),$=u("el-image"),G=u("el-empty"),he=u("pagination"),ge=u("el-carousel-item"),fe=u("el-carousel"),j=u("el-tab-pane"),ye=u("dict-tag"),ke=u("el-skeleton"),J=u("el-rate"),be=u("el-progress"),Ie=u("el-avatar"),we=u("Star"),Ce=u("el-tabs"),Ve=u("el-dialog"),Re=Te("loading");return o(),i("div",Je,[Xe,e("div",Ye,[s(pe,{model:_(g),ref:"queryRef",inline:!0,"label-width":"80px"},{default:c(()=>[s(U,{label:"产品名称"},{default:c(()=>[s(f,{modelValue:_(g).title,"onUpdate:modelValue":l[0]||(l[0]=t=>_(g).title=t),placeholder:"搜索目的地或产品名称",clearable:"",onKeyup:Ae(q,["enter"]),class:"search-input"},null,8,["modelValue"])]),_:1}),s(U,{label:"行程天数"},{default:c(()=>[s(ve,{modelValue:_(g).durationDays,"onUpdate:modelValue":l[1]||(l[1]=t=>_(g).durationDays=t),placeholder:"选择天数",clearable:""},{default:c(()=>[s(D,{value:3,label:"3天以内"}),s(D,{value:5,label:"3-5天"}),s(D,{value:7,label:"5-7天"}),s(D,{value:10,label:"7-10天"}),s(D,{value:99,label:"10天以上"})]),_:1},8,["modelValue"])]),_:1}),s(U,null,{default:c(()=>[s(V,{type:"primary",icon:"Search",onClick:q},{default:c(()=>[y("搜索")]),_:1}),s(V,{icon:"Refresh",onClick:le},{default:c(()=>[y("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),e("div",Ze,[e("div",et,[tt,e("div",st,[lt,s(me,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=t=>T.value=t),onChange:ae},{default:c(()=>[s(W,{label:"default"},{default:c(()=>[y("默认")]),_:1}),s(W,{label:"days"},{default:c(()=>[y("天数")]),_:1})]),_:1},8,["modelValue"])])]),X((o(),i("div",at,[(o(!0),i(b,null,I(R.value,t=>(o(),i("div",{key:t.productId,class:"product-card"},[e("div",ot,[s($,{src:t.coverImage||K,"preview-src-list":t.coverImage?[t.coverImage]:[],fit:"cover"},{error:c(()=>[e("div",nt,[s(x,null,{default:c(()=>[s(_(Fe))]),_:1}),it])]),_:2},1032,["src","preview-src-list"]),t.status===1?(o(),i("div",ct,ut)):v("",!0)]),e("div",rt,[e("div",_t,[e("h3",null,n(t.title),1),e("div",vt,[s(x,null,{default:c(()=>[s(_(qe))]),_:1}),e("span",null,n(t.durationDays)+"天"+n(t.durationNights)+"晚",1)])]),e("p",pt,n(t.subtitle),1),e("div",mt,[e("div",ht,[s(x,null,{default:c(()=>[s(_(Y))]),_:1}),e("span",null,"成团人数: "+n(t.minTravelers)+"-"+n(t.maxTravelers)+"人",1)]),e("div",gt,[s(x,null,{default:c(()=>[s(_(Be))]),_:1}),e("span",null,[y("目的地: "),(o(!0),i(b,null,I(O.value,p=>(o(),i("span",{key:p.destinationId},[p.destinationId===t.destinationId?(o(),i("span",ft,n(p.name),1)):v("",!0)]))),128))])])]),e("div",yt,[s(V,{type:"primary",onClick:p=>oe(t),class:"detail-btn"},{default:c(()=>[y(" 查看详情 ")]),_:2},1032,["onClick"])])])]))),128)),R.value.length===0&&!S.value?(o(),i("div",kt,[s(G,{description:"暂无产品数据"})])):v("",!0)])),[[Re,S.value]]),X(s(he,{total:A.value,page:_(g).pageNum,"onUpdate:page":l[3]||(l[3]=t=>_(g).pageNum=t),limit:_(g).pageSize,"onUpdate:limit":l[4]||(l[4]=t=>_(g).pageSize=t),onPagination:F},null,8,["total","page","limit"]),[[Oe,A.value>0]])]),s(Ve,{title:M.value,modelValue:N.value,"onUpdate:modelValue":l[9]||(l[9]=t=>N.value=t),width:"1000px","append-to-body":"","before-close":de},{footer:c(()=>{var t;return[e("div",Ps,[s(V,{type:"primary",size:"large",onClick:l[7]||(l[7]=p=>ce(d.value.productId)),disabled:((t=d.value)==null?void 0:t.status)!==1},{default:c(()=>[y(" 我要购买 ")]),_:1},8,["disabled"]),s(V,{size:"large",onClick:l[8]||(l[8]=p=>P.value="reviews")},{default:c(()=>[y(" 查看评价 ")]),_:1})])]}),default:c(()=>[d.value?(o(),i("div",bt,[e("div",It,[s($,{src:d.value.coverImage||K,fit:"cover"},{error:c(()=>[wt]),_:1},8,["src"])]),e("div",Ct,[s(Ce,{modelValue:P.value,"onUpdate:modelValue":l[6]||(l[6]=t=>P.value=t),class:"detail-tabs"},{default:c(()=>[s(j,{label:"产品相册",name:"images"},{default:c(()=>[e("div",Vt,[_(B).length>0?(o(),E(fe,{key:0,height:"400px","indicator-position":"outside",arrow:"always"},{default:c(()=>[(o(!0),i(b,null,I(_(B),(t,p)=>(o(),E(ge,{key:p},{default:c(()=>[s($,{src:t,class:"carousel-image",fit:"contain","preview-src-list":_(B),"preview-teleported":!0},null,8,["src","preview-src-list"])]),_:2},1024))),128))]),_:1})):(o(),i("div",Rt,"暂无图片"))])]),_:1}),s(j,{label:"产品介绍",name:"introduction"},{default:c(()=>[e("div",St,[Lt,e("div",Ut,[e("div",Dt,[e("div",xt,[Nt,e("span",null,n(d.value.productId),1)]),e("div",Pt,[$t,(o(!0),i(b,null,I(H.value,t=>(o(),i("span",{key:t.categoryId},[t.categoryId===d.value.categoryId?(o(),i("span",zt,n(t.name),1)):v("",!0)]))),128))]),e("div",Tt,[At,(o(!0),i(b,null,I(O.value,t=>(o(),i("span",{key:t.destinationId},[t.destinationId===d.value.destinationId?(o(),i("span",Ft,n(t.name),1)):v("",!0)]))),128))])]),e("div",qt,[e("div",Bt,[Ot,e("span",null,n(d.value.durationDays)+"天"+n(d.value.durationNights)+"晚",1)]),e("div",jt,[Et,e("span",null,n(d.value.minTravelers)+"-"+n(d.value.maxTravelers)+"人",1)]),e("div",Kt,[Mt,s(ye,{options:_(te),value:d.value.status},null,8,["options","value"])])])]),Qt,e("div",Ht,n(d.value.overview||"暂无概述信息"),1),Wt,e("div",Gt,n(d.value.itinerary||"暂无行程安排信息"),1),Jt,e("div",Xt,[e("div",Yt,[Zt,e("p",null,n(d.value.inclusions||"暂无包含信息"),1)]),e("div",es,[ts,e("p",null,n(d.value.exclusions||"暂无不含信息"),1)])]),ss,e("div",ls,n(d.value.notes||"暂无预订须知"),1)])]),_:1}),s(j,{label:"用户评价",name:"reviews"},{default:c(()=>[e("div",as,[e("div",os,[ns,L.value?(o(),i("div",is,[s(ke,{active:"",rows:3})])):v("",!0)]),L.value?v("",!0):(o(),i("div",cs,[h.value.length>0?(o(),i("div",ds,[e("div",us,[e("div",rs,n(C.value.toFixed(1)),1),e("div",_s,[s(J,{modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=t=>C.value=t),disabled:"","allow-half":""},null,8,["modelValue"])]),e("div",vs,n(h.value.length)+" 条评价",1)]),e("div",ps,[(o(),i(b,null,I(ee,t=>e("div",{class:"rating-item",key:t.key},[e("span",ms,n(t.label),1),s(be,{percentage:Q(t.key),"stroke-width":8,"show-text":!1},null,8,["percentage"]),e("span",hs,n(Q(t.key).toFixed(1)),1)])),64))])])):v("",!0),e("div",gs,[(o(!0),i(b,null,I(h.value,t=>(o(),i("div",{key:t.reviewId,class:"review-item"},[e("div",fs,[e("div",ys,[s(Ie,{icon:_(Y)},null,8,["icon"]),e("span",ks,n(t.isAnonymous?"匿名用户":`用户${t.userId}`),1)]),e("div",bs,n(t.createdAt),1)]),e("div",Is,[s(J,{modelValue:t.overallRating,"onUpdate:modelValue":p=>t.overallRating=p,disabled:"","allow-half":""},null,8,["modelValue","onUpdate:modelValue"]),e("span",ws,n(t.title),1)]),e("div",Cs,n(t.content),1),t.imageUrls?(o(),i("div",Vs,[(o(!0),i(b,null,I(t.imageUrls.split(","),(p,Se)=>(o(),E($,{key:Se,src:p,"preview-src-list":t.imageUrls.split(","),class:"review-img",fit:"cover"},null,8,["src","preview-src-list"]))),128))])):v("",!0),t.likeCount>=0?(o(),i("div",Rs,[s(V,{type:t.isLiked?"warning":"default",onClick:p=>ue(t),size:"small"},{default:c(()=>[s(x,null,{default:c(()=>[s(we)]),_:1}),y(" "+n(t.isLiked?"已点赞":"点赞")+" ",1),t.likeCount>0?(o(),i("span",Ss,"("+n(t.likeCount)+")",1)):v("",!0)]),_:2},1032,["type","onClick"])])):v("",!0),t.replyContent?(o(),i("div",Ls,[Us,e("div",Ds,n(t.replyContent),1),e("div",xs,n(t.repliedAt),1)])):v("",!0)]))),128)),h.value.length===0?(o(),i("div",Ns,[s(G,{description:"暂无评价"})])):v("",!0)])]))])]),_:1})]),_:1},8,["modelValue"])])])):v("",!0)]),_:1},8,["title","modelValue"])])}}}),Os=Le(zs,[["__scopeId","data-v-8fcc8fd5"]]);export{Os as default};
